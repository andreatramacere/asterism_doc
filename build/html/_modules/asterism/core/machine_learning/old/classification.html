
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>asterism.core.machine_learning.old.classification &#8212; asterism 1.0.a documentation</title>
    
    <link rel="stylesheet" href="../../../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '1.0.a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="top" title="asterism 1.0.a documentation" href="../../../../../index.html" />
    <link rel="up" title="Module code" href="../../../../index.html" /> 
  </head>
  <body role="document">

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<br><img src="../../../../../_static/logo.png" style=width:80%; " />  <br>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">asterism 1.0.a documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
     <div class="documentwrapper">
       <div class="bodywrapper">
        <div class="body">
         <div class="align-left figure align-left">


        </div>
           
  <h1>Source code for asterism.core.machine_learning.old.classification</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;Example Google style docstrings.</span>

<span class="sd">This module demonstrates documentation as specified by the `Google Python</span>
<span class="sd">Style Guide`_. Docstrings may extend over multiple lines. Sections are created</span>
<span class="sd">with a section header and a colon followed by a block of indented text.</span>

<span class="sd">Example:</span>
<span class="sd">    Examples can be given using either the ``Example`` or ``Examples``</span>
<span class="sd">    sections. Sections support any reStructuredText formatting, including</span>
<span class="sd">    literal blocks::</span>

<span class="sd">        $ python example_google.py</span>

<span class="sd">Section breaks are created by resuming unindented text. Section breaks</span>
<span class="sd">are also implicitly created anytime a new section starts.</span>

<span class="sd">Attributes:</span>
<span class="sd">    module_level_variable1 (int): Module level variables may be documented in</span>
<span class="sd">        either the ``Attributes`` section of the module docstring, or in an</span>
<span class="sd">        inline docstring immediately following the variable.</span>

<span class="sd">        Either form is acceptable, but the two should not be mixed. Choose</span>
<span class="sd">        one convention to document module level variables and be consistent</span>
<span class="sd">        with it.</span>

<span class="sd">.. _Google Python Style Guide:</span>
<span class="sd">   http://google.github.io/styleguide/pyguide.html</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">absolute_import</span> <span class="c">#, print_function</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;andrea tramacere&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Created on Jan 29, 2015</span>

<span class="sd">@author: orion</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">pyfits</span> <span class="k">as</span> <span class="nn">pf</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.lib.recfunctions</span> <span class="k">import</span> <span class="n">stack_arrays</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="k">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span><span class="n">AdaBoostClassifier</span><span class="p">,</span><span class="n">GradientBoostingClassifier</span><span class="p">,</span><span class="n">ExtraTreesClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="k">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="k">import</span> <span class="n">LinearSVC</span><span class="p">,</span><span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">LogisticRegression</span><span class="p">,</span><span class="n">SGDClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="k">import</span> <span class="n">KNeighborsClassifier</span><span class="p">,</span><span class="n">KernelDensity</span>
<span class="kn">from</span> <span class="nn">sklearn.lda</span> <span class="k">import</span> <span class="n">LDA</span>
<span class="kn">from</span> <span class="nn">sklearn.qda</span> <span class="k">import</span> <span class="n">QDA</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="k">import</span> <span class="n">GaussianNB</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="k">import</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="k">import</span> <span class="n">BernoulliRBM</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="k">import</span> <span class="n">Pipeline</span>

<span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="k">import</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="k">import</span> <span class="n">StratifiedKFold</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="k">import</span> <span class="n">tree</span>
<span class="kn">from</span> <span class="nn">sklearn.externals</span> <span class="k">import</span> <span class="n">joblib</span>

<span class="c">#import matplotlib</span>
<span class="c">#from numpy import ndarray</span>
<span class="c">#matplotlib.use(&#39;Agg&#39;)</span>

<span class="k">try</span><span class="p">:</span>

    <span class="kn">import</span> <span class="nn">matplotlib</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s">&#39;Agg&#39;</span><span class="p">)</span>


    <span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="c">#from scipy import ndimag</span>
    <span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="k">import</span> <span class="n">Ellipse</span><span class="p">,</span> <span class="n">Circle</span>

    <span class="c">#from  matplotlib.pyplot.arrow as arrow</span>
    <span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>

    <span class="c">#from scipy import ndimage</span>
    <span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
    <span class="c">#from matplotlib.colors import Normalize</span>

<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s">&quot;no pylab found&quot;</span>


<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="k">import</span> <span class="n">gaussian_filter</span>
<span class="c">#from matplotlib.colors import ListedColormap</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">log</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors.kde</span> <span class="k">import</span> <span class="n">KernelDensity</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="k">import</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
<span class="c">#from scipy.constants.constants import alpha</span>
<span class="c">#from wx.lib.agw.persist.persist_handlers import hasSB</span>

<div class="viewcode-block" id="write_table"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.write_table">[docs]</a><span class="k">def</span> <span class="nf">write_table</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">fp</span><span class="p">,</span><span class="n">class_col</span><span class="p">):</span>

    <span class="nb">print</span> <span class="n">class_col</span>
    <span class="n">nrows_tot</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">nrows_tot</span><span class="p">):</span>
        <span class="c">#print data[ID].size</span>
        <span class="n">a</span><span class="o">=</span><span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="n">a</span><span class="o">+=</span><span class="s">&quot;%s, &quot;</span><span class="o">%</span><span class="n">data</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

        <span class="c">#a+=&quot;%s &quot;%data[ID][-1]</span>
        <span class="nb">print</span><span class="o">&gt;&gt;</span><span class="n">fp</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">class_col</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span></div>


<div class="viewcode-block" id="write_weka_file"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.write_weka_file">[docs]</a><span class="k">def</span> <span class="nf">write_weka_file</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">features_names</span><span class="p">,</span><span class="n">class_labels</span><span class="p">,</span><span class="n">relation</span><span class="o">=</span><span class="s">&#39;galaxy_shape&#39;</span><span class="p">,):</span>


    <span class="n">fp</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>

    <span class="nb">str</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">    % 1. Title:</span>
<span class="s">    %</span>
<span class="s">    % 2. Sources:</span>
<span class="s">    &quot;&quot;&quot;</span>

    <span class="nb">str</span><span class="o">+=</span><span class="s">&quot;@RELATION %s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">relation</span><span class="p">)</span>


    <span class="nb">print</span><span class="o">&gt;&gt;</span><span class="n">fp</span><span class="p">,</span><span class="nb">str</span>

    <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">features_names</span><span class="p">:</span>
            <span class="c">#if &#39;i1xx&#39; == columns_dtype[col_name]:</span>
            <span class="c">#    datatype=&#39;{True,False}&#39;</span>
            <span class="c">#else:</span>
            <span class="n">datatype</span><span class="o">=</span><span class="s">&#39;NUMERIC&#39;</span>
            <span class="nb">print</span><span class="o">&gt;&gt;</span><span class="n">fp</span><span class="p">,</span><span class="s">&quot;@ATTRIBUTE&quot;</span><span class="p">,</span><span class="n">col_name</span> <span class="p">,</span> <span class="n">datatype</span>

    <span class="c">#print len(features_names)</span>
    <span class="n">data_classes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">class_labels</span><span class="p">)</span>
    <span class="n">data_classes_str</span><span class="o">=</span><span class="s">&#39;&#39;</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data_classes</span><span class="p">:</span>
        <span class="n">data_classes_str</span><span class="o">+=</span><span class="s">&#39;%s,&#39;</span><span class="o">%</span><span class="n">c</span>

    <span class="c">#if t_set==True:</span>
    <span class="nb">print</span><span class="o">&gt;&gt;</span><span class="n">fp</span><span class="p">,</span><span class="s">&quot;@ATTRIBUTE&quot;</span><span class="p">,</span> <span class="s">&#39;Morph&#39;</span><span class="p">,</span> <span class="s">&#39;{%s}&#39;</span><span class="o">%</span><span class="n">data_classes_str</span>

    <span class="nb">print</span><span class="o">&gt;&gt;</span><span class="n">fp</span><span class="p">,</span><span class="s">&quot;@DATA&quot;</span>
    <span class="nb">print</span><span class="o">&gt;&gt;</span><span class="n">fp</span>


    <span class="n">write_table</span><span class="p">(</span><span class="n">features</span><span class="p">,</span><span class="n">fp</span><span class="p">,</span><span class="n">class_labels</span><span class="p">)</span>

    <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="do_plot"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.do_plot">[docs]</a><span class="k">def</span> <span class="nf">do_plot</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">):</span>

    <span class="kn">from</span> <span class="nn">sklearn</span> <span class="k">import</span> <span class="n">clone</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlBu</span>
    <span class="n">plot_colors</span> <span class="o">=</span> <span class="s">&quot;ryb&quot;</span>

    <span class="n">X</span><span class="o">=</span><span class="n">X</span> <span class="p">[:,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">]]</span>
    <span class="n">clf</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">clf</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
    <span class="n">plot_step</span> <span class="o">=</span> <span class="mf">0.02</span>  <span class="c"># fine step width for decision surface contours</span>
    <span class="n">plot_step_coarser</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c"># step widths for coarse classifier guesses</span>

    <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span>   <span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">plot_step</span><span class="p">),</span>
                             <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">plot_step</span><span class="p">))</span>
    <span class="n">estimator_alpha</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">estimators_</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">estimators_</span><span class="p">:</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">xx</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">yy</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="n">cs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">estimator_alpha</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

    <span class="n">xx_coarser</span><span class="p">,</span> <span class="n">yy_coarser</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">plot_step_coarser</span><span class="p">),</span>
                                             <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">plot_step_coarser</span><span class="p">))</span>
    <span class="n">Z_points_coarser</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">xx_coarser</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">yy_coarser</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xx_coarser</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="c">#cs_points = plt.scatter(xx_coarser, yy_coarser, s=15, c=Z_points_coarser, cmap=cmap, edgecolors=&quot;none&quot;)</span>

    <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xrange</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">plot_colors</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Y</span> <span class="o">==</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>


    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>



<div class="viewcode-block" id="do_confusion_matrix"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.do_confusion_matrix">[docs]</a><span class="k">def</span> <span class="nf">do_confusion_matrix</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">file_name</span><span class="o">=</span><span class="s">&#39;conf_matrix&#39;</span><span class="p">,</span><span class="n">file_type</span><span class="o">=</span><span class="s">&#39;pdf&#39;</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;./&#39;</span><span class="p">):</span>
    <span class="n">classes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="s">&#39;actual&#39;</span><span class="p">])</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="s">&#39;actual&#39;</span><span class="p">],</span> <span class="n">predictions</span><span class="p">[</span><span class="s">&#39;pred&#39;</span><span class="p">],</span><span class="n">labels</span><span class="o">=</span><span class="n">classes</span><span class="p">)</span>
    <span class="n">cm_normalized</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;float&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">cm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="nb">print</span> <span class="n">cm</span>
    <span class="nb">print</span> <span class="n">cm_normalized</span>
    <span class="n">fs</span><span class="o">=</span><span class="mi">18</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fs</span><span class="o">&lt;</span><span class="mi">9</span><span class="p">:</span>
        <span class="n">fs</span><span class="o">=</span><span class="mi">9</span>
    <span class="k">if</span> <span class="n">plot</span><span class="o">==</span><span class="k">True</span> <span class="ow">or</span> <span class="n">save_plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;confusion matrix&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">28</span><span class="p">)</span>
        <span class="n">ind</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">))</span>
        <span class="c">#rects1 = ax.bar(ind,features_importance[&#39;imp&#39;],width, color=&#39;r&#39;, yerr=features_importance[&#39;imp_err&#39;])</span>
        <span class="c">#rects1 = ax.bar(ind,features_importance[&#39;imp&#39;],width, color=&#39;r&#39;,)</span>
        <span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">=</span>  <span class="n">cm</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span> <span class="n">col</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">row</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">%1.1f%%&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">cm</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">],</span><span class="n">cm_normalized</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">cm_normalized</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Greens</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span> <span class="n">classes</span> <span class="p">,</span><span class="n">rotation</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span> <span class="n">classes</span> <span class="p">,</span><span class="n">rotation</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">),</span><span class="mi">0</span><span class="p">])</span>
        <span class="c">#ax.set_xlim([-1,len(classes)+1])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Predicted&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Acutal&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">save_plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;%s/%s.%s&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">file_name</span><span class="p">,</span><span class="n">file_type</span><span class="p">))</span>
    <span class="nb">print</span>
    <span class="nb">print</span></div>



<div class="viewcode-block" id="do_roc_test"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.do_roc_test">[docs]</a><span class="k">def</span> <span class="nf">do_roc_test</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span><span class="n">classes</span><span class="p">,</span><span class="n">label</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">file_name</span><span class="o">=</span><span class="s">&#39;roc_test&#39;</span><span class="p">,</span><span class="n">file_type</span><span class="o">=</span><span class="s">&#39;pdf&#39;</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;./&#39;</span><span class="p">):</span>
    <span class="n">y</span><span class="o">=</span><span class="n">predictions</span><span class="p">[</span><span class="s">&#39;actual&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">label</span>
    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="o">*</span><span class="mi">1</span>
    <span class="n">prob_col</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">classes</span><span class="o">==</span><span class="n">label</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">predictions</span><span class="p">[</span><span class="s">&#39;proba&#39;</span><span class="p">][:,</span><span class="n">prob_col</span><span class="p">])</span>
    <span class="n">roc_auc</span><span class="o">=</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span><span class="n">tpr</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_plot</span><span class="o">==</span><span class="k">True</span> <span class="ow">or</span> <span class="n">plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Receiver Operating Characteristic&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;AUC = %0.2f&#39;</span><span class="o">%</span> <span class="n">roc_auc</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&#39;lower right&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;r--&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.2</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.2</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;True Positive Rate&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;False Positive Rate&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">save_plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;%s/%s.%s&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">file_name</span><span class="p">,</span><span class="n">file_type</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">roc_auc</span><span class="p">,</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span></div>

<div class="viewcode-block" id="eval_feature_entropy"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.eval_feature_entropy">[docs]</a><span class="k">def</span> <span class="nf">eval_feature_entropy</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>


    <span class="n">n_labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>


    <span class="n">hist_feature</span><span class="p">,</span><span class="n">bin_edges</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>

    <span class="n">P_feature</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_labels</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">hist_feature</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
    <span class="n">H_fetaure</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_labels</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">hist_feature</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
    <span class="n">H_class</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_labels</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">n_labels</span><span class="p">):</span>
        <span class="c">#print np.histogram(feature[labels==label],bins=bin_edges,normed=False)</span>
        <span class="n">P_feature</span><span class="p">[</span><span class="n">ID</span><span class="p">],</span><span class="n">foo</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="n">labels</span><span class="o">==</span><span class="n">label</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bin_edges</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="k">False</span><span class="p">)</span>
        <span class="n">msk</span><span class="o">=</span><span class="n">hist_feature</span><span class="o">&gt;</span><span class="mf">0.0</span>
        <span class="n">P_feature</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">P_feature</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="n">msk</span><span class="p">])</span><span class="o">/</span><span class="n">hist_feature</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>
        <span class="n">H_fetaure</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span><span class="o">=-</span><span class="n">P_feature</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">P_feature</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="n">msk</span><span class="p">])</span>
        <span class="n">H_fetaure</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="n">P_feature</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="c">#print hist_tot,histogram_matrix[ID]</span>
        <span class="n">class_p</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">labels</span><span class="o">==</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">/</span><span class="n">labels</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="n">class_p</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="p">:</span>
            <span class="n">H_class</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="o">=-</span><span class="n">class_p</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">class_p</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">H_class</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>

        <span class="n">H_fetaure</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span>

    <span class="n">H_class</span><span class="o">=</span><span class="n">H_class</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="n">P_feature</span><span class="o">=</span><span class="n">P_feature</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">H_fetaure</span><span class="o">=</span><span class="n">H_fetaure</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">H_fetaure</span><span class="o">=</span><span class="n">P_feature</span><span class="o">*</span><span class="n">H_fetaure</span>
    <span class="n">H_gain</span><span class="o">=</span><span class="n">H_class</span><span class="o">-</span><span class="n">H_fetaure</span>

    <span class="k">return</span> <span class="n">H_gain</span><span class="p">,</span><span class="n">H_fetaure</span><span class="p">,</span><span class="n">bin_edges</span></div>

<div class="viewcode-block" id="do_plot_feature_entropy"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.do_plot_feature_entropy">[docs]</a><span class="k">def</span> <span class="nf">do_plot_feature_entropy</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span><span class="n">feature_name</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
                            <span class="n">file_name</span><span class="o">=</span><span class="s">&#39;feat_entropy&#39;</span><span class="p">,</span>
                            <span class="n">plot</span><span class="o">=</span><span class="k">True</span><span class="p">,</span>
                            <span class="n">save_plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
                            <span class="n">path</span><span class="o">=</span><span class="s">&#39;./&#39;</span><span class="p">,</span>
                            <span class="n">file_type</span><span class="o">=</span><span class="s">&#39;pdf&#39;</span> <span class="p">):</span>

    <span class="n">H_norm</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">bin_edges</span><span class="o">=</span><span class="n">eval_feature_entropy</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
    <span class="c">#print H_norm,H,bin_edges</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="k">if</span> <span class="n">plot</span><span class="o">==</span><span class="k">True</span> <span class="ow">or</span> <span class="n">save_plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="c">#print x,x.shape</span>
        <span class="c">#print H</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">feature_name</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="s">&#39;-o&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save_plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;%s/%s.%s&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">file_name</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="n">feature_name</span><span class="p">,</span><span class="n">file_type</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">plot</span><span class="o">==</span><span class="k">True</span> <span class="ow">or</span> <span class="n">save_plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="plot_feature_histogram"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.plot_feature_histogram">[docs]</a><span class="k">def</span> <span class="nf">plot_feature_histogram</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span><span class="n">feature_name</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">KDE</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
                           <span class="n">gridsize</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                           <span class="n">pred</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
                           <span class="n">plot</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
                           <span class="n">file_name</span><span class="o">=</span><span class="s">&#39;feat_histogram&#39;</span><span class="p">,</span>
                           <span class="n">file_type</span><span class="o">=</span><span class="s">&#39;pdf&#39;</span><span class="p">,</span>
                           <span class="n">path</span><span class="o">=</span><span class="s">&#39;./&#39;</span><span class="p">,</span>
                           <span class="n">exclude_outliers</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
                           <span class="n">ax</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>

    <span class="nb">print</span> <span class="s">&#39;feature name&#39;</span><span class="p">,</span><span class="n">feature_name</span>
    <span class="k">if</span> <span class="n">pred</span><span class="o">==</span><span class="k">None</span><span class="p">:</span>
        <span class="n">labels</span><span class="o">=</span><span class="n">labels</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">labels</span><span class="o">=</span><span class="n">pred</span>

    <span class="n">l_labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">hist_data</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">hist_labels</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">l_labels</span><span class="p">:</span>
        <span class="n">feat</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="n">labels</span><span class="o">==</span><span class="n">label</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">exclude_outliers</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
            <span class="n">m</span><span class="o">=</span><span class="n">feat</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">s</span><span class="o">=</span><span class="n">feat</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
            <span class="n">msk1</span><span class="o">=</span><span class="n">feat</span><span class="o">&lt;</span><span class="n">m</span><span class="o">+</span><span class="n">exclude_outliers</span><span class="o">*</span><span class="n">s</span>
            <span class="n">msk2</span><span class="o">=</span><span class="n">feat</span><span class="o">&gt;</span><span class="n">m</span><span class="o">-</span><span class="n">exclude_outliers</span><span class="o">*</span><span class="n">s</span>
            <span class="n">feat</span><span class="o">=</span><span class="n">feat</span><span class="p">[</span><span class="n">msk1</span><span class="o">*</span><span class="n">msk2</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">range</span><span class="o">==</span><span class="k">None</span> <span class="ow">or</span> <span class="nb">range</span><span class="o">==</span><span class="p">[]</span> <span class="p">:</span>
            <span class="n">size</span><span class="o">=</span><span class="n">feat</span><span class="o">.</span><span class="n">size</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msk1</span><span class="o">=</span><span class="n">feat</span><span class="o">&gt;</span><span class="nb">range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
                <span class="n">msk2</span><span class="o">=</span><span class="n">feat</span><span class="o">&lt;</span><span class="nb">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msk2</span><span class="o">=</span><span class="n">msk1</span>
            <span class="n">feat</span><span class="o">=</span><span class="n">feat</span><span class="p">[</span><span class="n">msk1</span><span class="o">*</span><span class="n">msk2</span><span class="p">]</span>

            <span class="n">size</span><span class="o">=</span><span class="n">feat</span><span class="o">.</span><span class="n">size</span>
        <span class="n">hist_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">feat</span> <span class="p">)</span>
        <span class="n">hist_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="o">+</span><span class="s">&#39; N=%d&#39;</span><span class="o">%</span><span class="n">size</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s">&quot;label:&quot;</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="s">&quot; size:&quot;</span><span class="p">,</span><span class="n">size</span>
        <span class="c">#print np.float64(feature[labels==label]).shape</span>

    <span class="k">if</span> <span class="n">plot</span><span class="o">==</span><span class="k">True</span> <span class="ow">or</span> <span class="n">save_plot</span><span class="o">==</span><span class="k">True</span> <span class="ow">or</span> <span class="n">ax</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s">&quot;white&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ax</span><span class="o">==</span><span class="k">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">feature_name</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">KDE</span><span class="o">==</span><span class="k">False</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">hist_data</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">hist_labels</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s">&#39;bar&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="n">normed</span><span class="p">,</span><span class="n">stacked</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hist_labels</span><span class="p">):</span>
                <span class="c">#bandwidth = ((4 * hist_data[ID].std() ** 5) / (3 * len(hist_data[ID]))) ** .2</span>
                <span class="c">#bandwidth = len(hist_data[ID]) ** (-1. / 5)</span>
                <span class="k">if</span> <span class="n">label</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;E&#39;</span><span class="p">:</span>
                    <span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span>
                <span class="nb">print</span> <span class="s">&quot;label&quot;</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">color</span>
                <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">hist_data</span><span class="p">[</span><span class="n">ID</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">shade</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="n">gridsize</span><span class="o">=</span><span class="n">gridsize</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">save_plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;%s/%s.%s&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">file_name</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="n">feature_name</span><span class="p">,</span><span class="n">file_type</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">plot</span><span class="o">==</span><span class="k">True</span> <span class="ow">or</span> <span class="n">save_plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span></div>

<div class="viewcode-block" id="validation_results"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.validation_results">[docs]</a><span class="k">class</span> <span class="nc">validation_results</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">tp</span><span class="p">,</span><span class="n">tn</span><span class="p">,</span><span class="n">fp</span><span class="p">,</span><span class="n">fn</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="n">scorr_classif</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="n">wrong_classif</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">=</span><span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">=</span><span class="n">tp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tn</span><span class="o">=</span><span class="n">tn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">=</span><span class="n">fp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="o">=</span><span class="n">fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="n">size</span></div>
        <span class="c">#self.corr_classif=corr_classif</span>
        <span class="c">#self.wrong_classif=wrong_classif</span>



<div class="viewcode-block" id="average_cv_stats"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.average_cv_stats">[docs]</a><span class="k">def</span> <span class="nf">average_cv_stats</span><span class="p">(</span><span class="n">validation_results_obj_list</span><span class="p">,</span><span class="n">labels</span><span class="p">):</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>


    <span class="nb">print</span> <span class="s">&quot;------------------------------------------&quot;</span>
    <span class="n">tot_corr</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">tot_wrong</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">size_tot</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>

        <span class="n">tp_tot</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">tn_tot</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">fp_tot</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">fn_tot</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">label_size</span><span class="o">=</span><span class="mi">0</span>


        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">validation_results_obj_list</span><span class="p">:</span>


            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">label</span><span class="o">==</span><span class="n">label</span><span class="p">:</span>

                <span class="n">tp_tot</span><span class="o">+=</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">tp</span><span class="p">)</span>
                <span class="n">tn_tot</span><span class="o">+=</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">tn</span><span class="p">)</span>
                <span class="n">fp_tot</span><span class="o">+=</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fp</span><span class="p">)</span>
                <span class="n">fn_tot</span><span class="o">+=</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fn</span><span class="p">)</span>
                <span class="c">#corr_av+=result.corr_classif</span>
                <span class="c">#wrong_av+=result.wrong_classif</span>

                <span class="c">#print &quot;label&quot;,result.size,repl</span>
                <span class="n">tot_corr</span><span class="o">+=</span><span class="n">result</span><span class="o">.</span><span class="n">tp</span>
                <span class="n">tot_wrong</span><span class="o">+=</span><span class="n">result</span><span class="o">.</span><span class="n">fn</span>

                <span class="n">label_size</span><span class="o">+=</span><span class="n">result</span><span class="o">.</span><span class="n">size</span>



        <span class="n">size_tot</span><span class="o">+=</span><span class="n">label_size</span>

        <span class="n">tp_rate</span><span class="o">=</span><span class="n">tp_tot</span><span class="o">/</span><span class="p">(</span><span class="n">tp_tot</span><span class="o">+</span><span class="n">fn_tot</span><span class="p">)</span>
        <span class="n">fp_rate</span><span class="o">=</span><span class="n">fp_tot</span><span class="o">/</span><span class="p">(</span><span class="n">fp_tot</span><span class="o">+</span><span class="n">tn_tot</span><span class="p">)</span>
        <span class="n">tn_rate</span><span class="o">=</span><span class="n">tn_tot</span><span class="o">/</span><span class="p">(</span><span class="n">fp_tot</span><span class="o">+</span><span class="n">tn_tot</span><span class="p">)</span>
        <span class="n">fn_rate</span><span class="o">=</span><span class="n">fn_tot</span><span class="o">/</span><span class="p">(</span><span class="n">tp_tot</span><span class="o">+</span><span class="n">fn_tot</span><span class="p">)</span>
        <span class="c">#tn_av=float(tn_av)/repl</span>
        <span class="c">#fp_av=float(fp_av)/repl</span>
        <span class="c">#fn_av=float(fn_av)/repl</span>
        <span class="c">#corr_av=float(corr_av)/repl</span>
        <span class="c">#wrong_av=flot(wrong_av)/repl</span>

        <span class="nb">print</span> <span class="s">&quot;  label:&quot;</span><span class="p">,</span><span class="n">label</span><span class="p">,</span>
        <span class="nb">print</span> <span class="s">&quot;  size:&quot;</span><span class="p">,</span><span class="n">label_size</span>
        <span class="nb">print</span> <span class="s">&quot;  tp_tot , rate:&quot;</span><span class="p">,</span><span class="n">tp_tot</span><span class="p">,</span><span class="n">tp_rate</span>
        <span class="nb">print</span> <span class="s">&quot;  tn_tot , rate:&quot;</span><span class="p">,</span><span class="n">tn_tot</span><span class="p">,</span><span class="n">tn_rate</span>
        <span class="nb">print</span> <span class="s">&quot;  fp_tot , rate:&quot;</span><span class="p">,</span><span class="n">fp_tot</span><span class="p">,</span><span class="n">fp_rate</span>
        <span class="nb">print</span> <span class="s">&quot;  fn_tot , rate:&quot;</span><span class="p">,</span><span class="n">fn_tot</span><span class="p">,</span><span class="n">fn_rate</span>
        <span class="k">if</span> <span class="n">tp_tot</span><span class="o">+</span><span class="n">fp_tot</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s">&quot;  precision: &quot;</span><span class="p">,</span><span class="n">tp_tot</span><span class="o">/</span><span class="p">(</span><span class="n">tp_tot</span><span class="o">+</span><span class="n">fp_tot</span><span class="p">)</span>


        <span class="nb">print</span> <span class="s">&quot;  recall:    &quot;</span><span class="p">,</span><span class="n">tp_rate</span>
        <span class="nb">print</span> <span class="s">&quot;  correctly classified:&quot;</span><span class="p">,</span><span class="n">tp_tot</span> <span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">tp_tot</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">tp_tot</span><span class="o">+</span><span class="n">fn_tot</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s">&quot;  wrongly classified:&quot;</span>  <span class="p">,</span><span class="n">fn_tot</span> <span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">fn_tot</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">tp_tot</span><span class="o">+</span><span class="n">fn_tot</span><span class="p">)</span>

        <span class="nb">print</span>
        <span class="nb">print</span>



    <span class="nb">print</span> <span class="s">&quot;total size&quot;</span><span class="p">,</span>   <span class="n">size_tot</span>
    <span class="nb">print</span> <span class="s">&quot;total correctly classified:&quot;</span><span class="p">,</span><span class="n">tot_corr</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">tot_corr</span><span class="p">)</span><span class="o">/</span><span class="n">size_tot</span>
    <span class="nb">print</span> <span class="s">&quot;tatal wrongly classified:&quot;</span><span class="p">,</span> <span class="n">tot_wrong</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">tot_wrong</span><span class="p">)</span><span class="o">/</span><span class="n">size_tot</span>
    <span class="nb">print</span> <span class="s">&quot;------------------------------------------&quot;</span>

    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">tot_corr</span><span class="p">)</span><span class="o">/</span><span class="n">size_tot</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">tot_wrong</span><span class="p">)</span><span class="o">/</span><span class="n">size_tot</span></div>




<div class="viewcode-block" id="eval_accuracy"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.eval_accuracy">[docs]</a><span class="k">def</span> <span class="nf">eval_accuracy</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span><span class="n">actual_classes</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>
    <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">actual_classes</span><span class="p">)</span>

    <span class="n">corr_classif</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">wrong_classif</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">out_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="nb">print</span> <span class="s">&quot;------------------------------------------&quot;</span>
    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>



        <span class="n">msk_actual</span><span class="o">=</span><span class="n">actual_classes</span><span class="o">==</span><span class="n">label</span>
        <span class="n">msk_pred</span><span class="o">=</span><span class="n">prediction</span><span class="o">==</span><span class="n">label</span>
        <span class="n">msk_tp</span><span class="o">=</span><span class="n">msk_actual</span><span class="o">*</span><span class="n">msk_pred</span>


        <span class="n">msk_tn</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">msk_actual</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">msk_pred</span><span class="p">)</span>

        <span class="n">tp</span><span class="o">=</span><span class="n">msk_tp</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">tn</span><span class="o">=</span><span class="n">msk_tn</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="n">msk_fp</span><span class="o">=</span><span class="n">msk_pred</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">msk_actual</span><span class="p">)</span>
        <span class="n">fp</span><span class="o">=</span> <span class="n">msk_fp</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="n">msk_fn</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">msk_pred</span><span class="p">)</span><span class="o">*</span><span class="n">msk_actual</span>
        <span class="n">fn</span><span class="o">=</span><span class="n">msk_fn</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="n">corr_classif</span><span class="o">+=</span><span class="n">tp</span>
        <span class="n">wrong_classif</span><span class="o">+=</span><span class="n">fn</span>
        <span class="n">size</span><span class="o">=</span><span class="n">msk_actual</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">tp</span><span class="o">+</span><span class="n">fn</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">tp_rate</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">tp</span><span class="o">+</span><span class="n">fn</span><span class="p">)</span>
            <span class="n">fn_rate</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">tp</span><span class="o">+</span><span class="n">fn</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tp_rate</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">fn_rate</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">if</span> <span class="n">fp</span><span class="o">+</span><span class="n">tn</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">fp_rate</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">fp</span><span class="o">+</span><span class="n">tn</span><span class="p">)</span>
            <span class="n">tn_rate</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">tn</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">fp</span><span class="o">+</span><span class="n">tn</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fp_rate</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">tn_rate</span><span class="o">=</span><span class="mi">0</span>


        <span class="k">if</span> <span class="n">verbose</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s">&quot;  label:&quot;</span><span class="p">,</span><span class="n">label</span>
            <span class="nb">print</span> <span class="s">&quot;  size:&quot;</span><span class="p">,</span><span class="n">size</span>
            <span class="nb">print</span> <span class="s">&quot;  tp:&quot;</span><span class="p">,</span><span class="n">tp</span><span class="p">,</span><span class="s">&#39; rate&#39;</span><span class="p">,</span><span class="n">tp_rate</span>
            <span class="nb">print</span> <span class="s">&quot;  tn:&quot;</span><span class="p">,</span><span class="n">tn</span><span class="p">,</span><span class="s">&#39; rate&#39;</span><span class="p">,</span><span class="n">tn_rate</span>
            <span class="nb">print</span> <span class="s">&quot;  fp:&quot;</span><span class="p">,</span><span class="n">fp</span><span class="p">,</span><span class="s">&#39; rate&#39;</span><span class="p">,</span><span class="n">fp_rate</span>
            <span class="nb">print</span> <span class="s">&quot;  fn:&quot;</span><span class="p">,</span><span class="n">fn</span><span class="p">,</span><span class="s">&#39; rate&#39;</span><span class="p">,</span><span class="n">fn_rate</span>

            <span class="nb">print</span> <span class="s">&quot;  correctly classified:&quot;</span><span class="p">,</span><span class="n">tp</span> <span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">tp</span><span class="o">+</span><span class="n">fn</span><span class="p">)</span>
            <span class="nb">print</span> <span class="s">&quot;  wrongly classified:&quot;</span>  <span class="p">,</span><span class="n">fn</span> <span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">tp</span><span class="o">+</span><span class="n">fn</span><span class="p">)</span>

            <span class="nb">print</span> <span class="s">&quot; precision&quot;</span><span class="p">,</span>  <span class="nb">float</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">tp</span><span class="o">+</span><span class="n">fp</span><span class="p">)</span>

            <span class="nb">print</span> <span class="s">&quot; accuracy&quot;</span><span class="p">,</span>  <span class="nb">float</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">tp</span><span class="o">+</span><span class="n">fn</span><span class="p">)</span>
            <span class="nb">print</span>

        <span class="n">out_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">validation_results</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="n">tp</span><span class="p">,</span><span class="n">tn</span><span class="p">,</span><span class="n">fp</span><span class="p">,</span><span class="n">fn</span><span class="p">,</span><span class="n">size</span><span class="p">))</span>


    <span class="nb">print</span>
    <span class="nb">print</span> <span class="s">&quot;total correctly classified:&quot;</span><span class="p">,</span><span class="n">corr_classif</span> <span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">corr_classif</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">corr_classif</span><span class="o">+</span><span class="n">wrong_classif</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s">&quot;total wrongly classified:&quot;</span><span class="p">,</span> <span class="n">wrong_classif</span> <span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">wrong_classif</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">corr_classif</span><span class="o">+</span><span class="n">wrong_classif</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s">&quot;------------------------------------------&quot;</span>

    <span class="k">return</span> <span class="n">out_list</span></div>





<div class="viewcode-block" id="remove_field_name"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.remove_field_name">[docs]</a><span class="k">def</span> <span class="nf">remove_field_name</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">skip_names</span><span class="p">):</span>
    <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">names</span>
    <span class="k">for</span> <span class="n">del_name</span> <span class="ow">in</span> <span class="n">skip_names</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">[:]:</span>
            <span class="k">if</span> <span class="n">del_name</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s">&quot;removing &quot;</span><span class="p">,</span><span class="n">name</span>
                <span class="n">names</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">names</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">,</span><span class="n">names</span></div>

<div class="viewcode-block" id="use_field_name"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.use_field_name">[docs]</a><span class="k">def</span> <span class="nf">use_field_name</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">use_names</span><span class="p">):</span>
    <span class="n">use_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">names</span>

    <span class="k">for</span> <span class="n">use_name</span> <span class="ow">in</span> <span class="n">use_names</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_name</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s">&quot;using &quot;</span><span class="p">,</span><span class="n">name</span>
                <span class="n">use_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>


    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">[:]:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">use_list</span><span class="p">:</span>
            <span class="n">names</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="nb">print</span> <span class="s">&quot;removing &quot;</span><span class="p">,</span><span class="n">name</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">names</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">,</span><span class="n">names</span></div>


<div class="viewcode-block" id="contour_scatter_plot"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.contour_scatter_plot">[docs]</a><span class="k">def</span>     <span class="nf">contour_scatter_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">classes</span><span class="p">,</span>
                             <span class="n">classes_types</span><span class="p">,</span>
                             <span class="n">H_cmap</span><span class="o">=</span><span class="s">&#39;grey&#39;</span><span class="p">,</span>
                             <span class="n">x_name</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span>
                             <span class="n">y_name</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">,</span>
                             <span class="n">n_levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                             <span class="n">smoothing_scale</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                             <span class="n">plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
                             <span class="n">ax</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
                             <span class="n">exclude_outliers</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
                             <span class="n">plot_H</span><span class="o">=</span><span class="k">True</span><span class="p">,</span>
                             <span class="n">plot_contour</span><span class="o">=</span><span class="k">True</span><span class="p">,</span>
                             <span class="n">plot_scatter</span><span class="o">=</span><span class="k">True</span><span class="p">,</span>
                             <span class="n">point_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                             <span class="n">color_list</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
                             <span class="n">c_map_list</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
                             <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="c">#colors=[&#39;b&#39;,&#39;r&#39;,&#39;g&#39;,&#39;y&#39;]</span>
    <span class="c">#print x,y</span>
    <span class="c">#colors=cm.rainbow(np.linspace(0,1,len(classes_types)+1))</span>
    <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">color_list</span><span class="o">==</span><span class="k">None</span><span class="p">:</span>
        <span class="n">color_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="s">&#39;yellow&#39;</span><span class="p">,</span><span class="s">&#39;orange&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">c_map_list</span><span class="o">==</span><span class="k">None</span><span class="p">:</span>
        <span class="n">c_map_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Reds&#39;</span><span class="p">,</span> <span class="s">&#39;Blues&#39;</span><span class="p">,</span> <span class="s">&#39;Reds&#39;</span><span class="p">,</span> <span class="s">&#39;Oranges&#39;</span><span class="p">,</span><span class="s">&#39;Reds&#39;</span><span class="p">]</span>



    <span class="k">if</span> <span class="n">exclude_outliers</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
        <span class="n">msk</span><span class="o">=</span><span class="p">[</span><span class="k">None</span><span class="p">,</span><span class="k">None</span><span class="p">]</span>
        <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">m</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">s</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
                <span class="n">msk1</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="o">&lt;</span><span class="n">m</span><span class="o">+</span><span class="n">exclude_outliers</span><span class="o">*</span><span class="n">s</span>
                <span class="n">msk2</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="o">&gt;</span><span class="n">m</span><span class="o">-</span><span class="n">exclude_outliers</span><span class="o">*</span><span class="n">s</span>
                <span class="n">msk</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="o">=</span><span class="n">msk1</span><span class="o">*</span><span class="n">msk2</span>



        <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">msk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">msk</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">msk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">msk</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">classes</span><span class="o">=</span><span class="n">classes</span><span class="p">[</span><span class="n">msk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">msk</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c">#cmap_contorus = colors.ListedColormap([&#39;blue&#39;, &#39;red&#39;,&#39;yellow&#39;,&#39;green&#39;,&#39;green&#39;])</span>
<span class="c">#     from matplotlib.colors import LinearSegmentedColormap</span>
<span class="c">#</span>
<span class="c">#     vmax = 3.0</span>
<span class="c">#     cmap_contorus = LinearSegmentedColormap.from_list(&#39;mycmap&#39;, [(0 / vmax, &#39;blue&#39;),</span>
<span class="c">#                                                         (1 / vmax, &#39;white&#39;),</span>
<span class="c">#                                                         (3 / vmax, &#39;red&#39;)]</span>
<span class="c">#                                             )</span>
<span class="c">#</span>
<span class="c">#</span>
    <span class="k">if</span> <span class="n">ax</span><span class="o">==</span><span class="k">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">=</span><span class="k">None</span>






    <span class="k">if</span> <span class="n">plot</span><span class="o">==</span><span class="k">True</span> <span class="ow">or</span> <span class="n">ax</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

        <span class="c">#extent = [xedges_tot[0], xedges_tot[-1], yedges_tot[0], yedges_tot[-1]]</span>

        <span class="c">#cmap=plt.get_cmap(cmap_name)</span>
        <span class="k">pass</span>

    <span class="n">H_sublcasses</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">cl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">classes_types</span><span class="p">):</span>
        <span class="n">x1</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">classes</span><span class="o">==</span><span class="n">cl</span><span class="p">]</span>
        <span class="n">y1</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="n">classes</span><span class="o">==</span><span class="n">cl</span><span class="p">]</span>
        <span class="nb">print</span> <span class="n">x1</span><span class="o">.</span><span class="n">shape</span>
        <span class="nb">print</span> <span class="n">y1</span><span class="o">.</span><span class="n">shape</span>


        <span class="n">H_tot</span><span class="p">,</span> <span class="n">xedges_tot</span><span class="p">,</span> <span class="n">yedges_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
        <span class="n">H_tot</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">xedges_tot</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">yedges_tot</span><span class="o">.</span><span class="n">shape</span>

        <span class="n">H_s</span><span class="p">,</span> <span class="n">xedges_s</span><span class="p">,</span> <span class="n">yedges_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="n">xedges_tot</span><span class="p">,</span><span class="n">yedges_tot</span><span class="p">))</span>
        <span class="n">H_sublcasses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H_s</span><span class="p">)</span>
        <span class="c">#H_s_plot=gaussian_filter(H_s,smoothing_scale)</span>
        <span class="n">H_s</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">xedges_s</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">yedges_s</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">xedges_tot</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xedges_tot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">yedges_s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yedges_s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>




        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xedges_s</span><span class="p">,</span> <span class="n">yedges_s</span><span class="p">)</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">plot_contour</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
            <span class="n">kernel</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">(</span><span class="n">values</span><span class="p">,)</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">kernel</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>


        <span class="c">#sns.jointplot(x1,y1, kind=&quot;kde&quot;)</span>
        <span class="c">#if plot_contour==True:</span>

        <span class="c">#    sns.kdeplot(x1,y1,ax=ax,cmap=c_map_list[ID])</span>
        <span class="k">if</span> <span class="n">plot</span><span class="o">==</span><span class="k">True</span> <span class="ow">or</span> <span class="n">ax</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">plot_scatter</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">point_size</span>  <span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color_list</span><span class="p">[</span><span class="n">ID</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">cl</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plot_contour</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
                <span class="n">vmin</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="n">vmax</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="mf">0.95</span>
                <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Z</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">Z</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span><span class="n">n_levels</span><span class="p">)</span>
                <span class="c">#c=cmap_contorus(float(ID)/len(classes_types))</span>
                <span class="c">#print c</span>
                <span class="n">cfset</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span> <span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">c_map_list</span><span class="p">[</span><span class="n">ID</span><span class="p">],</span><span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span><span class="n">linewidths</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
                <span class="c">#print H_s_plot</span>
                <span class="c">#cset = ax.contour(X,Y,H_s ,linewidths=1.5,cmap=c_map_list[ID],alpha=1.0,levels=levels,vmin=vmin,vmax=vmax)</span>

                <span class="c">#cset=ax.contour(xedges_tot[:-1],yedges_tot[:-1],H_s_plot.T,linewidths=0.5,color=colors(float(ID)/len(classes_types)))</span>
                <span class="c">#ax.clabel(cset, inline=1, fontsize=10, fmt=&#39;%1.0i&#39;)</span>
                <span class="c">#print X.shape,H_s_plot.shape</span>


    <span class="n">entr_tot</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">N_tot</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">ID_r</span><span class="p">,</span><span class="n">H_tot_r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">H_tot</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ID_c</span><span class="p">,</span><span class="n">foo</span><span class="p">,</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">H_tot_r</span><span class="p">):</span>
            <span class="n">N</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">entr</span><span class="o">=</span><span class="mi">0</span>

            <span class="k">for</span> <span class="n">H_sublcass</span> <span class="ow">in</span> <span class="n">H_sublcasses</span><span class="p">:</span>
                <span class="n">ni</span><span class="o">=</span><span class="n">H_sublcass</span><span class="p">[</span><span class="n">ID_r</span><span class="p">,</span><span class="n">ID_c</span><span class="p">]</span>
                <span class="n">N</span><span class="o">+=</span><span class="n">ni</span>
                <span class="n">N_tot</span><span class="o">+=</span><span class="n">ni</span>
                <span class="k">if</span> <span class="n">ni</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">entr</span><span class="o">+=</span><span class="n">ni</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">ni</span><span class="p">)</span>
                    <span class="n">entr_tot</span><span class="o">+=</span><span class="n">ni</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">ni</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">N</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">H_tot</span><span class="p">[</span><span class="n">ID_r</span><span class="p">,</span><span class="n">ID_c</span><span class="p">]</span><span class="o">=</span><span class="n">log</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">*</span><span class="n">entr</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">H_tot</span><span class="p">[</span><span class="n">ID_r</span><span class="p">,</span><span class="n">ID_c</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>

            <span class="c">#msk1=H_sublcass[0][ID]&gt;0.</span>
            <span class="c">#msk2=H_sublcass[1][ID]&gt;0.</span>
            <span class="c">#msk=msk1+msk2</span>
            <span class="c">#H_tot[ID][msk]=-(H_sublcass[0][ID][msk]-H_sublcass[1][ID][msk])/(H_sublcass[0][ID][msk]+H_sublcass[1][ID][msk])</span>
            <span class="c">#H_tot[ID][np.negative(msk)]=0.0</span>

            <span class="c">#size+=np.fabs(H_sublcass[0][ID][msk]+H_sublcass[1][ID][msk]).sum()</span>

            <span class="c">#power+=(np.fabs(H_tot[ID][msk])*np.fabs(H_sublcass[0][ID][msk]+H_sublcass[1][ID][msk])).sum()</span>

    <span class="n">entr_tot</span><span class="o">=</span><span class="n">log</span><span class="p">(</span><span class="n">N_tot</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">N_tot</span><span class="p">))</span><span class="o">*</span><span class="n">entr_tot</span>
    <span class="nb">print</span> <span class="n">x_name</span><span class="p">,</span><span class="n">y_name</span><span class="p">,</span><span class="n">entr_tot</span>

    <span class="k">if</span> <span class="n">plot</span><span class="o">==</span><span class="k">True</span> <span class="ow">or</span> <span class="n">ax</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plot_H</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
            <span class="n">H_plot</span><span class="o">=</span><span class="n">gaussian_filter</span><span class="p">(</span><span class="n">H_tot</span><span class="p">,</span><span class="n">smoothing_scale</span><span class="p">)</span>
            <span class="n">p</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">H_plot</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">H_cmap</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s">&#39;low&#39;</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s">&#39;auto&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

            <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="c">#ax.legend(loc=4)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_name</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">x_name</span><span class="p">,</span><span class="n">y_name</span><span class="p">,</span> <span class="n">entr_tot</span><span class="p">,</span><span class="n">fig</span></div>


<div class="viewcode-block" id="plot_fetures_importance"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.plot_fetures_importance">[docs]</a><span class="k">def</span> <span class="nf">plot_fetures_importance</span><span class="p">(</span><span class="n">features_importance</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">file_name</span><span class="o">=</span><span class="s">&#39;feat_imp&#39;</span><span class="p">,</span><span class="n">file_type</span><span class="o">=</span><span class="s">&#39;pdf&#39;</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;./&#39;</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;features importance&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
    <span class="n">width</span><span class="o">=</span><span class="mf">0.35</span>
    <span class="n">ind</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">features_importance</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="n">rects1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span><span class="n">features_importance</span><span class="p">[</span><span class="s">&#39;imp&#39;</span><span class="p">],</span><span class="n">width</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="c">#rects1 = ax.bar(ind,features_importance[&#39;imp&#39;],width, color=&#39;r&#39;,)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span> <span class="n">features_importance</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">save_plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;%s/%s.%s&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">file_name</span><span class="p">,</span><span class="n">file_type</span><span class="p">))</span>
    <span class="nb">print</span>
    <span class="nb">print</span></div>


<div class="viewcode-block" id="plot_feature_correlation_matrix"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.plot_feature_correlation_matrix">[docs]</a><span class="k">def</span> <span class="nf">plot_feature_correlation_matrix</span><span class="p">(</span><span class="n">features_names</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">file_name</span><span class="o">=</span><span class="s">&#39;feat_corr_matrix&#39;</span><span class="p">,</span><span class="n">file_type</span><span class="o">=</span><span class="s">&#39;pdf&#39;</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;./&#39;</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>

    <span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">features</span><span class="p">,</span><span class="n">rowvar</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>


    <span class="k">if</span> <span class="n">plot</span><span class="o">==</span><span class="k">True</span> <span class="ow">or</span> <span class="n">save_plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;features correlation&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
        <span class="n">ind</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">features_names</span><span class="p">))</span>
        <span class="c">#rects1 = ax.bar(ind,features_importance[&#39;imp&#39;],width, color=&#39;r&#39;, yerr=features_importance[&#39;imp_err&#39;])</span>
        <span class="c">#rects1 = ax.bar(ind,features_importance[&#39;imp&#39;],width, color=&#39;r&#39;,)</span>
        <span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">=</span>  <span class="n">c</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span> <span class="n">col</span><span class="p">,</span><span class="n">row</span><span class="o">+</span><span class="mf">0.55</span><span class="p">,</span><span class="s">&quot;%+2.2f&quot;</span><span class="o">%</span><span class="n">c</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span> <span class="n">features_names</span> <span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span> <span class="n">features_names</span> <span class="p">,</span><span class="n">rotation</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">features_names</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">features_names</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">save_plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;%s/%s.%s&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">file_name</span><span class="p">,</span><span class="n">file_type</span><span class="p">))</span>
    <span class="nb">print</span>
    <span class="nb">print</span></div>

<div class="viewcode-block" id="eval_features_importance"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.eval_features_importance">[docs]</a><span class="k">def</span> <span class="nf">eval_features_importance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">features_names</span><span class="p">,</span><span class="n">sort</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;./&#39;</span><span class="p">):</span>
    <span class="nb">print</span> <span class="n">model</span><span class="o">.</span><span class="n">feature_importances_</span><span class="o">.</span><span class="n">size</span>
    <span class="n">features_importance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">feature_importances_</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="s">&#39;S128&#39;</span><span class="p">),(</span><span class="s">&#39;imp&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),(</span><span class="s">&#39;imp_err&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)])</span>
    <span class="n">important_features_ID</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">feat_imp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">):</span>
        <span class="c">#std = np.std([tree.feature_importances_[ID] for tree in model.estimators_],axis=0)</span>
        <span class="c">#avg=  np.mean([tree.feature_importances_[ID] for tree in model.estimators_],axis=0)</span>
        <span class="c">#   print features_names[ID],feat_imp,avg,std</span>
        <span class="n">avg</span><span class="o">=</span><span class="n">feat_imp</span>
        <span class="n">std</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">features_importance</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">features_names</span><span class="p">[</span><span class="n">ID</span><span class="p">],</span><span class="n">avg</span><span class="p">,</span><span class="n">std</span> <span class="p">)</span>
        <span class="n">important_features_ID</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span>
        <span class="c">#print model.feature_importances_[ID],avg,std</span>
        <span class="c">#if feat_imp&gt;np.average(model.feature_importances_):</span>
        <span class="c">#    important_features_ID.append(ID)</span>


    <span class="c">#print &#39;importance sorted features:&#39;</span>


    <span class="k">if</span> <span class="n">sort</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">sorted_idx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">features_importance</span><span class="p">[</span><span class="s">&#39;imp&#39;</span><span class="p">])</span>
        <span class="n">features_importance</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s">&#39;imp&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sorted_idx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">features_importance</span><span class="p">[</span><span class="s">&#39;imp&#39;</span><span class="p">])</span>

    <span class="c">#for feature in features_importance:</span>
        <span class="c">#print feature</span>

    <span class="k">return</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">features_importance</span><span class="p">),</span><span class="n">sorted_idx</span><span class="p">,</span><span class="n">important_features_ID</span></div>


<div class="viewcode-block" id="eval_score"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.eval_score">[docs]</a><span class="k">def</span> <span class="nf">eval_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">cv</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">cv</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">)</span>
        <span class="n">scores_mean</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">scores_std</span><span class="o">=</span><span class="n">scores</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">scores</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">scores_mean</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">oob_score_</span>
        <span class="n">scores_std</span><span class="o">=</span><span class="mi">0</span>

    <span class="k">return</span> <span class="n">scores</span><span class="p">,</span><span class="n">scores_mean</span><span class="p">,</span><span class="n">scores_std</span></div>

<div class="viewcode-block" id="recursive_features_elimination"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.recursive_features_elimination">[docs]</a><span class="k">def</span> <span class="nf">recursive_features_elimination</span><span class="p">(</span><span class="n">features_names</span><span class="p">,</span>
                                   <span class="n">features</span><span class="p">,</span>
                                   <span class="n">model</span><span class="p">,</span>
                                   <span class="n">labels</span><span class="p">,</span>
                                   <span class="n">percentile_th</span><span class="p">,</span>
                                   <span class="n">feat_n_min</span><span class="p">,</span>
                                   <span class="n">path</span><span class="o">=</span><span class="s">&#39;./&#39;</span><span class="p">,</span>
                                   <span class="n">plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
                                   <span class="n">save_plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
                                   <span class="n">file_type</span><span class="o">=</span><span class="s">&#39;pdf&#39;</span><span class="p">,</span>
                                   <span class="n">file_name</span><span class="o">=</span><span class="s">&#39;rec_feat_rem&#39;</span><span class="p">):</span>

    <span class="n">features_names</span><span class="o">=</span><span class="n">features_names</span><span class="p">[:]</span>
    <span class="n">best_features_set</span><span class="o">=</span><span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features_names</span><span class="p">]</span>

    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="s">&#39;oob_score_&#39;</span><span class="p">):</span>
            <span class="n">cv</span><span class="o">=</span><span class="k">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cv</span><span class="o">=</span><span class="mi">3</span>
    <span class="n">scores</span><span class="p">,</span><span class="n">scores_mean</span><span class="p">,</span><span class="n">scores_std</span> <span class="o">=</span> <span class="n">eval_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">)</span>

    <span class="n">best_score</span><span class="o">=</span><span class="n">scores_mean</span>
    <span class="n">x_coord</span><span class="o">=</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span> <span class="n">features_names</span><span class="p">)]</span>

    <span class="n">y</span><span class="o">=</span><span class="p">[</span> <span class="n">scores_mean</span><span class="p">]</span>
    <span class="n">dy</span><span class="o">=</span><span class="p">[</span><span class="n">scores_std</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s">&quot;--&gt;  score full features&quot;</span><span class="p">,</span> <span class="n">scores_mean</span><span class="p">,</span><span class="n">scores_std</span> <span class="p">,</span><span class="s">&#39;cv&#39;</span><span class="p">,</span><span class="n">cv</span>



    <span class="n">features</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
    <span class="n">delta_l</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">features_names</span><span class="p">)</span><span class="o">&gt;</span><span class="n">feat_n_min</span> <span class="ow">and</span> <span class="n">delta_l</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">features_importance</span><span class="p">,</span><span class="n">sorted_idx</span><span class="p">,</span><span class="n">important_features_ID</span><span class="o">=</span><span class="n">eval_features_importance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">features_names</span><span class="p">,</span><span class="n">sort</span><span class="o">=</span><span class="k">False</span><span class="p">)</span>
        <span class="c">#print np.percentile(features_importance[&#39;imp&#39;],percentile_th)</span>
        <span class="n">th</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">features_importance</span><span class="p">[</span><span class="s">&#39;imp&#39;</span><span class="p">],</span><span class="n">percentile_th</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s">&quot;th=&quot;</span><span class="p">,</span><span class="n">th</span><span class="p">,</span><span class="n">features_importance</span><span class="p">[</span><span class="s">&#39;imp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">remove_list</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">features_importance</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;imp&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">th</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s">&quot;removing &quot;</span><span class="p">,</span><span class="n">features_importance</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">],</span><span class="s">&quot; importance&quot;</span><span class="p">,</span><span class="n">features_importance</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="s">&#39;imp&#39;</span><span class="p">]</span>
                <span class="n">remove_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span>


        <span class="n">features</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">features</span><span class="p">,</span><span class="n">remove_list</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>



        <span class="n">l1</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">features_names</span><span class="p">)</span>
        <span class="n">features_names</span><span class="o">=</span><span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">features_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">remove_list</span><span class="p">]</span>
        <span class="n">l2</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">features_names</span><span class="p">)</span>
        <span class="n">delta_l</span><span class="o">=</span><span class="n">l1</span><span class="o">-</span><span class="n">l2</span>
        <span class="nb">print</span> <span class="s">&quot;delta l&quot;</span><span class="p">,</span><span class="n">delta_l</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">l2</span>
        <span class="nb">print</span> <span class="s">&quot;FIT&quot;</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">,</span><span class="n">scores_mean</span><span class="p">,</span><span class="n">scores_std</span> <span class="o">=</span> <span class="n">eval_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">)</span>


        <span class="n">x_coord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="n">features_names</span><span class="p">))</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">scores_mean</span><span class="p">)</span>
        <span class="n">dy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scores_std</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s">&quot;--&gt; score after removing  %f +/- %f&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">scores_mean</span><span class="p">,</span> <span class="n">scores_std</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">scores_mean</span><span class="o">&gt;</span><span class="n">best_score</span><span class="p">:</span>
            <span class="n">best_score</span><span class="o">=</span><span class="n">scores_mean</span>
            <span class="n">best_features_set</span><span class="o">=</span><span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features_names</span><span class="p">]</span>



    <span class="k">if</span> <span class="n">plot</span><span class="o">==</span><span class="k">True</span> <span class="ow">or</span> <span class="n">save_plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>



        <span class="n">title</span><span class="o">=</span><span class="s">&#39;recursive feature elimination&#39;</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x_coord</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">dy</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;o-&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;features&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;score&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>


        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span>  <span class="n">plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span>  <span class="n">save_plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
         <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;%s/%s.%s&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">file_name</span><span class="p">,</span><span class="n">file_type</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">best_features_set</span></div>






<div class="viewcode-block" id="show_single_feature"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.show_single_feature">[docs]</a><span class="k">def</span> <span class="nf">show_single_feature</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">train_set</span><span class="p">,</span><span class="n">features_names</span><span class="p">,</span><span class="n">labels</span><span class="p">):</span>
    <span class="n">features_names</span><span class="o">=</span><span class="n">features_names</span><span class="p">[:]</span>



    <span class="k">for</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">features_names</span><span class="p">)):</span>
        <span class="n">train_set</span><span class="o">=</span><span class="n">train_set</span><span class="p">[:,</span><span class="n">ID</span><span class="p">]</span>
        <span class="nb">print</span> <span class="n">train_set</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_set</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
        <span class="n">scores_1</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_set</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="n">scores_1</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_set</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">scores_1_mean</span><span class="o">=</span><span class="n">scores_1</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">scores_1_std</span><span class="o">=</span><span class="n">scores_1</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span>
        <span class="n">y</span><span class="o">=</span><span class="p">[</span> <span class="n">scores_1_mean</span><span class="p">]</span>
        <span class="n">dy</span><span class="o">=</span><span class="p">[</span><span class="n">scores_1_std</span><span class="p">]</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">dy</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>



<div class="viewcode-block" id="remove_most_corr_features"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.remove_most_corr_features">[docs]</a><span class="k">def</span> <span class="nf">remove_most_corr_features</span><span class="p">(</span><span class="n">features</span><span class="p">,</span><span class="n">features_names</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">max_corr</span><span class="p">,</span><span class="n">stage</span><span class="p">):</span>
    <span class="n">REMOVED</span><span class="o">=</span><span class="k">False</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
    <span class="c">#print &quot;features names&quot;,len(features_names),train_set.shape</span>
    <span class="c">#print &quot;train set shape&quot;,train_set.shape</span>
    <span class="c">#print &quot;features_names len&quot;,len(features_names)</span>
    <span class="n">features_importance</span><span class="p">,</span><span class="n">sorted_idx</span><span class="p">,</span><span class="n">important_features_ID</span><span class="o">=</span><span class="n">eval_features_importance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">features_names</span><span class="p">,</span><span class="n">sort</span><span class="o">=</span><span class="k">False</span><span class="p">)</span>

    <span class="c">#start from then most important feature</span>
    <span class="n">most_imp_id</span><span class="o">=</span><span class="mi">0</span><span class="o">-</span><span class="n">stage</span>
    <span class="n">sorted_idx</span><span class="o">=</span> <span class="n">sorted_idx</span><span class="p">[::</span><span class="n">most_imp_id</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">sel_id</span> <span class="ow">in</span> <span class="n">sorted_idx</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="nb">print</span> <span class="s">&quot;working on feature&quot;</span><span class="p">,</span> <span class="n">features_names</span><span class="p">[</span><span class="n">sel_id</span><span class="p">]</span>

        <span class="c">#eval features corr matrix</span>
        <span class="n">c_matr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">features</span><span class="p">,</span><span class="n">rowvar</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">c_arr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">c_matr</span><span class="p">[</span><span class="n">sel_id</span><span class="p">])</span>
        <span class="c">#print c_arr, c_arr.shape</span>



        <span class="c">#find the corr terms above max_corr</span>
        <span class="n">cor_ids</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">c_arr</span><span class="p">)</span><span class="o">&gt;</span><span class="n">max_corr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c">#remove the diagonal term</span>
        <span class="n">cor_ids_no_diag</span><span class="o">=</span><span class="n">cor_ids</span><span class="p">[</span><span class="n">cor_ids</span><span class="o">!=</span><span class="n">sel_id</span><span class="p">]</span>

        <span class="nb">print</span> <span class="s">&quot;selected ids&quot;</span><span class="p">,</span><span class="n">cor_ids_no_diag</span><span class="p">,</span><span class="n">c_arr</span><span class="p">[</span><span class="n">cor_ids_no_diag</span><span class="p">]</span>
        <span class="c">#print &quot;len c_arr&quot;,len(c_arr),features_importance.shape</span>

        <span class="k">if</span> <span class="n">cor_ids_no_diag</span><span class="o">.</span><span class="n">size</span><span class="o">&gt;</span><span class="mi">0</span> <span class="p">:</span>
            <span class="c">#select less important feature among most correlated</span>
            <span class="n">feature_ids</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">features_importance</span><span class="p">[</span><span class="s">&#39;imp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)[[</span><span class="n">cor_ids_no_diag</span><span class="p">]]</span>
            <span class="n">remove_id</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">features_importance</span><span class="p">[</span><span class="s">&#39;imp&#39;</span><span class="p">][</span><span class="n">cor_ids_no_diag</span><span class="p">])</span>
            <span class="n">remove_id</span><span class="o">=</span><span class="n">feature_ids</span><span class="p">[</span><span class="n">remove_id</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">remove_id</span> <span class="ow">in</span> <span class="n">cor_ids_no_diag</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s">&quot;remove id&quot;</span><span class="p">,</span><span class="n">remove_id</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">features_names</span><span class="p">)</span>
                <span class="c">#remove the feature from the set</span>
                <span class="nb">print</span> <span class="s">&quot;removing &quot;</span><span class="p">,</span><span class="n">features_names</span><span class="p">[</span><span class="n">remove_id</span><span class="p">],</span><span class="n">features_importance</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">][</span><span class="n">remove_id</span><span class="p">],</span> <span class="s">&#39;imp=&#39;</span><span class="p">,</span><span class="n">features_importance</span><span class="p">[</span><span class="s">&#39;imp&#39;</span><span class="p">][</span><span class="n">remove_id</span><span class="p">],</span> <span class="s">&#39;corr=&#39;</span><span class="p">,</span><span class="n">c_arr</span><span class="p">[</span><span class="n">remove_id</span><span class="p">]</span>

            <span class="n">features_names</span><span class="o">=</span><span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">features_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">ID</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cor_ids_no_diag</span><span class="p">]</span>
            <span class="n">features</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">features</span><span class="p">,</span><span class="n">cor_ids_no_diag</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

                <span class="c">#rfc.fit(features, labels)</span>
                <span class="c">#scores_1 = cross_val_score(rfc, features, labels, cv=10)</span>
                <span class="c">#scores_1_mean=scores_1.mean()</span>
                <span class="c">#scores_1_std=scores_1.std()</span>

                <span class="c">#print &quot;--&gt; new score&quot;, scores_1_mean,scores_1_std</span>

            <span class="n">REMOVED</span><span class="o">=</span><span class="k">True</span>
            <span class="k">return</span> <span class="n">REMOVED</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">features_names</span>

    <span class="k">return</span> <span class="n">REMOVED</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">features_names</span></div>

<div class="viewcode-block" id="remove_correlated_features"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.remove_correlated_features">[docs]</a><span class="k">def</span> <span class="nf">remove_correlated_features</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">features_names</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">max_corr</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;./&#39;</span><span class="p">):</span>




    <span class="n">REMOVED</span><span class="o">=</span><span class="k">True</span>
    <span class="n">stage</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">while</span> <span class="n">REMOVED</span><span class="o">==</span><span class="k">True</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">features_names</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s">&quot;stage &quot;</span><span class="p">,</span><span class="n">stage</span>
        <span class="n">REMOVED</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">features_names</span><span class="o">=</span><span class="n">remove_most_corr_features</span><span class="p">(</span><span class="n">features</span><span class="p">,</span><span class="n">features_names</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">max_corr</span><span class="p">,</span><span class="n">stage</span><span class="p">)</span>
        <span class="n">stage</span><span class="o">+=</span><span class="mi">1</span>
        <span class="nb">print</span>
        <span class="nb">print</span>

    <span class="nb">print</span> <span class="s">&quot;correlated featuere selection done&quot;</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s">&quot;model score &quot;</span><span class="p">,</span><span class="n">eval_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">labels</span><span class="p">)</span>



    <span class="n">features_importance</span><span class="p">,</span><span class="n">sorted_idx</span><span class="p">,</span><span class="n">important_features_ID</span><span class="o">=</span><span class="n">eval_features_importance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">features_names</span><span class="p">,</span><span class="n">sort</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>


    <span class="n">plot_fetures_importance</span><span class="p">(</span><span class="n">features_importance</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">file_name</span><span class="o">=</span><span class="s">&#39;feat_imp_post_corr_feat_removal&#39;</span><span class="p">)</span>
    <span class="n">plot_feature_correlation_matrix</span><span class="p">(</span><span class="n">features_names</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s">&quot;features shape&quot;</span><span class="p">,</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span>
    <span class="nb">print</span> <span class="s">&quot;features names len&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">features_names</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">features</span><span class="p">,</span><span class="n">features_names</span></div>


<div class="viewcode-block" id="features_importance_trend"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.features_importance_trend">[docs]</a><span class="k">def</span> <span class="nf">features_importance_trend</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">features_names</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">n_trees</span><span class="p">,</span><span class="n">order_increasing</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="n">file_type</span><span class="o">=</span><span class="s">&#39;pdf&#39;</span><span class="p">,</span><span class="n">file_name</span><span class="o">=</span><span class="s">&#39;feat_imp_trend&#39;</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;./&#39;</span><span class="p">):</span>
    <span class="c">#rfc = RandomForestClassifier(n_estimators=n_trees)</span>

    <span class="n">features_names</span><span class="o">=</span><span class="n">features_names</span><span class="p">[:]</span>
    <span class="n">ind</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">features_names</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">order_increasing</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">sel_id</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sel_id</span><span class="o">=-</span><span class="mi">1</span>

    <span class="n">scores_1</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">scores_1_mean</span><span class="o">=</span><span class="n">scores_1</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">scores_1_std</span><span class="o">=</span><span class="n">scores_1</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">x_coord</span><span class="o">=</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span> <span class="n">features_names</span><span class="p">)]</span>
    <span class="n">x_lab</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;all&#39;</span><span class="p">]</span>
    <span class="n">y</span><span class="o">=</span><span class="p">[</span> <span class="n">scores_1_mean</span><span class="p">]</span>
    <span class="n">dy</span><span class="o">=</span><span class="p">[</span><span class="n">scores_1_std</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s">&quot;--&gt; score full features&quot;</span><span class="p">,</span> <span class="n">scores_1_mean</span><span class="p">,</span><span class="n">scores_1_std</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
    <span class="n">features_importance</span><span class="p">,</span><span class="n">sorted_idx</span><span class="p">,</span><span class="n">important_features_ID</span><span class="o">=</span><span class="n">eval_features_importance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">features_names</span><span class="p">)</span>

    <span class="nb">print</span> <span class="s">&quot;removing &quot;</span><span class="p">,</span><span class="n">features_importance</span><span class="p">[</span><span class="n">sel_id</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">],</span><span class="s">&quot; importance&quot;</span><span class="p">,</span><span class="n">features_importance</span><span class="p">[</span><span class="n">sel_id</span><span class="p">][</span><span class="s">&#39;imp&#39;</span><span class="p">]</span>
    <span class="n">features_names</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">sorted_idx</span><span class="p">[</span><span class="n">sel_id</span><span class="p">])</span>
    <span class="n">train_set</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">features</span><span class="p">,</span><span class="n">sorted_idx</span><span class="p">[</span><span class="n">sel_id</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">scores_2</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_set</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">scores_2_mean</span><span class="o">=</span><span class="n">scores_2</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">scores_2_std</span><span class="o">=</span><span class="n">scores_2</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="nb">print</span> <span class="s">&quot;--&gt; score after removing %s, %f +/- %f&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">features_importance</span><span class="p">[</span><span class="n">sel_id</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">],</span> <span class="n">scores_2_mean</span><span class="p">,</span> <span class="n">scores_2_std</span><span class="p">)</span>

    <span class="n">x_coord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="n">features_names</span><span class="p">))</span>
    <span class="n">x_lab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">features_importance</span><span class="p">[</span><span class="n">sel_id</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">scores_2_mean</span><span class="p">)</span>
    <span class="n">dy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scores_2_std</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">features_names</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
    <span class="c">#while (scores_2_mean)&gt;=(scores_1_mean):</span>
        <span class="n">socres_1_mean</span><span class="o">=</span><span class="n">scores_2_mean</span>
        <span class="n">socres_1_std</span><span class="o">=</span><span class="n">scores_2_std</span>
        <span class="c">#rfc = RandomForestClassifier(n_estimators=n_trees)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_set</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
        <span class="n">features_importance</span><span class="p">,</span><span class="n">sorted_idx</span><span class="p">,</span><span class="n">important_features_ID</span><span class="o">=</span><span class="n">eval_features_importance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">features_names</span><span class="p">)</span>
        <span class="n">features_names</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">sorted_idx</span><span class="p">[</span><span class="n">sel_id</span><span class="p">])</span>
        <span class="n">train_set</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">train_set</span><span class="p">,</span><span class="n">sorted_idx</span><span class="p">[</span><span class="n">sel_id</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s">&quot;removing &quot;</span><span class="p">,</span><span class="n">features_importance</span><span class="p">[</span><span class="n">sel_id</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">scores_2</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_set</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">scores_2_mean</span><span class="o">=</span><span class="n">scores_2</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">scores_2_std</span><span class="o">=</span><span class="n">scores_2</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="c">#plot_fetures_importance(features_importance)</span>

        <span class="n">x_coord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="n">features_names</span><span class="p">))</span>
        <span class="n">x_lab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">features_importance</span><span class="p">[</span><span class="n">sel_id</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">scores_2_mean</span><span class="p">)</span>
        <span class="n">dy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scores_2_std</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s">&quot;--&gt; score after removing %s, %f +/- %f&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">features_importance</span><span class="p">[</span><span class="n">sel_id</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">],</span> <span class="n">scores_2_mean</span><span class="p">,</span> <span class="n">scores_2_std</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot</span><span class="o">==</span><span class="k">True</span> <span class="ow">or</span> <span class="n">save_plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>


        <span class="k">if</span> <span class="n">order_increasing</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
            <span class="n">title</span><span class="o">=</span><span class="s">&#39;remove increasingly important features&#39;</span>
            <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="o">+</span><span class="s">&#39;_incr&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title</span><span class="o">=</span><span class="s">&#39;remove decreasingly important features&#39;</span>
            <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="o">+</span><span class="s">&#39;_decr&#39;</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x_coord</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">dy</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_coord</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span> <span class="n">x_lab</span> <span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span>  <span class="n">plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span>  <span class="n">save_plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
         <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;%s/%s.%s&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">file_name</span><span class="p">,</span><span class="n">file_type</span><span class="p">))</span></div>
    <span class="c">#return features_names,train_set</span>

<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.main">[docs]</a><span class="k">def</span> <span class="nf">main</span> <span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;sp_infile&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;fits file with  sp analysis results&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="k">None</span> <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;ell_infile&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;fits file with ell analysis results&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="k">None</span> <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-test_set&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;fits file with ell analysis results&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="k">None</span> <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-skip_attr&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;fits file with ell analysis results&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="k">None</span> <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-ring_infile&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;fits file with ring analysis results&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="k">None</span> <span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">data_sp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pf</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">sp_infile</span><span class="p">))</span>
    <span class="n">data_ell</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pf</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">ell_infile</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">test_set</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
        <span class="n">test_set</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pf</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">test_set</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">test_set</span><span class="o">=</span><span class="k">None</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">ring_infile</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
        <span class="n">ring_data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pf</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">ring_infile</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ring_data</span><span class="o">=</span><span class="k">None</span>

    <span class="n">run</span><span class="p">(</span><span class="n">data_sp</span><span class="p">,</span><span class="n">data_ell</span><span class="p">,</span><span class="n">test_set</span><span class="o">=</span><span class="n">test_set</span><span class="p">,</span><span class="n">ring_data</span><span class="o">=</span><span class="n">ring_data</span><span class="p">)</span></div>



<div class="viewcode-block" id="find_best_tree_num"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.find_best_tree_num">[docs]</a><span class="k">def</span> <span class="nf">find_best_tree_num</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">cv</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">file_name</span><span class="o">=</span><span class="s">&#39;best_tree_num&#39;</span><span class="p">,</span><span class="n">file_type</span><span class="o">=</span><span class="s">&#39;pdf&#39;</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;./&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="s">&#39;n_features&#39;</span><span class="p">):</span>
        <span class="n">n</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">n_features</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n</span><span class="o">=</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">n_min</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">n_max</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="n">n</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">n_trees_arr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">n_min</span><span class="p">,</span><span class="n">n_max</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">score_t</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_trees_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([(</span><span class="s">&#39;score&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),(</span><span class="s">&#39;score_err&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),((</span><span class="s">&#39;n_trees&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))]))</span>
    <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">n_trees</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">n_trees_arr</span><span class="p">):</span>
        <span class="c">#model = RandomForestClassifier(n_estimators=n_trees,oob_score=True)</span>

        <span class="n">model</span><span class="o">.</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">n_trees</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">,)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="s">&#39;oob_score_&#39;</span><span class="p">):</span>
            <span class="n">cv</span><span class="o">=</span><span class="k">False</span>

        <span class="k">if</span> <span class="n">cv</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

            <span class="nb">print</span>
            <span class="nb">print</span><span class="p">(</span><span class="s">&quot;Trees:%d Accuracy: %0.5f (+/- %0.5f)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n_trees</span><span class="p">,</span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores</span><span class="o">.</span><span class="n">std</span><span class="p">()))</span>
            <span class="c">#score_t.append(scores.mean())</span>
            <span class="n">score_t</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="n">scores</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span><span class="n">n_trees</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s">&quot;Trees:%d OOB score: %0.5f &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n_trees</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">oob_score_</span><span class="p">))</span>
            <span class="n">score_t</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">oob_score_</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">n_trees</span><span class="p">)</span>

            <span class="c">#results.append( myEvaluationFunc(labels[testcv], [x[1] for x in probas]) )</span>

        <span class="c">#print &quot;Results: &quot; + str( np.array(results).mean() )</span>


    <span class="n">score_t</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">score_t</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;score&#39;</span><span class="p">,</span> <span class="s">&#39;n_trees&#39;</span><span class="p">,</span><span class="s">&#39;score_err&#39;</span><span class="p">])</span>
    <span class="n">best_tree_num</span><span class="o">=</span><span class="n">score_t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;n_trees&#39;</span><span class="p">]</span>

    <span class="nb">print</span> <span class="s">&quot;best trees number&quot;</span><span class="p">,</span><span class="n">best_tree_num</span>

    <span class="k">if</span> <span class="n">save_plot</span><span class="o">==</span><span class="k">True</span> <span class="ow">or</span> <span class="n">plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;best  estimators num&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">score_t</span><span class="p">[</span><span class="s">&#39;n_trees&#39;</span><span class="p">],</span> <span class="n">score_t</span><span class="p">[</span><span class="s">&#39;score&#39;</span><span class="p">]</span> <span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">score_t</span><span class="p">[</span><span class="s">&#39;score_err&#39;</span><span class="p">],</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;best tree num = %d&#39;</span><span class="o">%</span> <span class="n">best_tree_num</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&#39;lower right&#39;</span><span class="p">)</span>
        <span class="c">#plt.legend(loc=&#39;lower right&#39;)</span>
        <span class="c">#plt.plot([0,1],[0,1],&#39;r--&#39;)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">n_trees_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">0.9</span><span class="p">,</span><span class="n">n_trees_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">1.1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">score_t</span><span class="p">[</span><span class="s">&#39;score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">*</span><span class="mf">0.9</span><span class="p">,</span><span class="n">score_t</span><span class="p">[</span><span class="s">&#39;score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="mf">1.1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;accuracy&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;n estimators&#39;</span><span class="p">)</span>
        <span class="c">#ax.set_xscale(&#39;log&#39;)</span>
    <span class="k">if</span> <span class="n">plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">save_plot</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;%s/%s.%s&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">file_name</span><span class="p">,</span><span class="n">file_type</span><span class="p">))</span>


    <span class="k">return</span> <span class="n">best_tree_num</span></div>

<div class="viewcode-block" id="do_MC"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.do_MC">[docs]</a><span class="k">def</span> <span class="nf">do_MC</span><span class="p">(</span><span class="n">features</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">n_repl</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">score_t</span><span class="o">=</span><span class="p">[]</span>
    <span class="c">#rfc = RandomForestClassifier(n_estimators=n_trees)</span>
        <span class="c">#print labels,new_data</span>
    <span class="n">model</span><span class="o">=</span><span class="s">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">n_repl</span><span class="p">):</span>


        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="nb">print</span>
        <span class="nb">print</span><span class="p">(</span><span class="s">&quot; Accuracy: %0.2f (+/- %0.2f)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">score_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>


            <span class="c">#results.append( myEvaluationFunc(labels[testcv], [x[1] for x in probas]) )</span>

        <span class="c">#print &quot;Results: &quot; + str( np.array(results).mean() )</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">score_t</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;precision&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">score_t</span><span class="p">)</span></div>

<div class="viewcode-block" id="do_cross_fold_validation"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.do_cross_fold_validation">[docs]</a><span class="k">def</span>  <span class="nf">do_cross_fold_validation</span><span class="p">(</span><span class="n">features</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">labels_num</span><span class="p">,</span><span class="n">original_id</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">n_folds</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>
    <span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">n_folds</span><span class="o">=</span><span class="n">n_folds</span><span class="p">,</span><span class="n">shuffle</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
    <span class="c">#print cv</span>

    <span class="n">tot_size</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">traincv</span><span class="p">,</span> <span class="n">testcv</span> <span class="ow">in</span> <span class="n">cv</span><span class="p">:</span>
        <span class="n">tot_size</span><span class="o">+=</span><span class="nb">len</span><span class="p">(</span><span class="n">testcv</span><span class="p">)</span>


    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ID_CV</span><span class="o">=</span><span class="mi">0</span>

    <span class="n">prediction_dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([(</span><span class="s">&#39;image_id&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),(</span><span class="s">&#39;actual&#39;</span><span class="p">,</span> <span class="s">&#39;S16&#39;</span><span class="p">),(</span><span class="s">&#39;pred&#39;</span><span class="p">,</span> <span class="s">&#39;S16&#39;</span><span class="p">),(</span><span class="s">&#39;error&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">),(</span><span class="s">&#39;proba&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))])</span>

    <span class="n">predictions</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">tot_size</span><span class="p">,</span><span class="n">prediction_dtype</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">traincv</span><span class="p">,</span> <span class="n">testcv</span> <span class="ow">in</span> <span class="n">cv</span><span class="p">:</span>
        <span class="c">#pred_class=[]</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="s">&quot;len(traincv), len(testcv), ID:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">traincv</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">testcv</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ID_CV</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s">&quot;FIT&quot;</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="n">traincv</span><span class="p">],</span> <span class="n">labels</span><span class="p">[</span><span class="n">traincv</span><span class="p">])</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="n">testcv</span><span class="p">])</span>
            <span class="n">labels_num</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">traincv</span><span class="p">])</span><span class="o">.</span><span class="n">size</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="nb">print</span> <span class="s">&quot;FIT&quot;</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="n">traincv</span><span class="p">],</span> <span class="n">labels</span><span class="p">[</span><span class="n">traincv</span><span class="p">])</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="n">testcv</span><span class="p">])</span>
            <span class="c">#pred = model.fit(features[traincv], labels[traincv])</span>
            <span class="c">#pred_class=model.predict(features[testcv])</span>
            <span class="c">#pred=np.zeros((len(testcv),len(model.classes_)))</span>
            <span class="c">#for ID_1,pc in enumerate(pred_class):</span>
            <span class="c">#    for ID_2,model_c in enumerate(model.classes_):</span>
            <span class="c">#        if pc==model_c:</span>
            <span class="c">#            pred[ID_1][ID_2]=1.0</span>
        <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pred</span><span class="p">):</span>
            <span class="n">pmax_id</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="c">#pred_class.append(rfc.classes_[pmax_id])</span>
            <span class="c">#print p, pmax_id, rfc.classes_[pmax_id]</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
                <span class="nb">print</span>  <span class="s">&quot;original id&quot;</span><span class="p">,</span><span class="n">original_id</span><span class="p">[</span><span class="n">testcv</span><span class="p">[</span><span class="n">ID</span><span class="p">]],</span><span class="s">&#39; actual=&#39;</span><span class="p">,</span><span class="n">labels</span><span class="p">[</span><span class="n">testcv</span><span class="p">][</span><span class="n">ID</span><span class="p">],</span> <span class="s">&#39; predicted=&#39;</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">classes_</span><span class="p">[</span><span class="n">pmax_id</span><span class="p">],</span><span class="s">&#39; proba&#39;</span><span class="p">,</span><span class="n">p</span>

            <span class="n">predictions</span><span class="p">[</span><span class="s">&#39;image_id&#39;</span><span class="p">][</span><span class="n">ID</span><span class="o">+</span><span class="n">ID_CV</span><span class="p">]</span><span class="o">=</span><span class="n">original_id</span><span class="p">[</span><span class="n">testcv</span><span class="p">[</span><span class="n">ID</span><span class="p">]]</span>
            <span class="n">predictions</span><span class="p">[</span><span class="s">&#39;actual&#39;</span><span class="p">][</span><span class="n">ID</span><span class="o">+</span><span class="n">ID_CV</span><span class="p">]</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">testcv</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span>
            <span class="n">predictions</span><span class="p">[</span><span class="s">&#39;pred&#39;</span><span class="p">][</span><span class="n">ID</span><span class="o">+</span><span class="n">ID_CV</span><span class="p">]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">classes_</span><span class="p">[</span><span class="n">pmax_id</span><span class="p">]</span>
            <span class="n">predictions</span><span class="p">[</span><span class="s">&#39;error&#39;</span><span class="p">][</span><span class="n">ID</span><span class="o">+</span><span class="n">ID_CV</span><span class="p">]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">classes_</span><span class="p">[</span><span class="n">pmax_id</span><span class="p">]</span><span class="o">!=</span><span class="n">labels</span><span class="p">[</span><span class="n">testcv</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span>
            <span class="c">#print p</span>
            <span class="c">#print  predictions[&#39;proba&#39;][ID+ID_CV].shape, p.shape</span>
            <span class="n">predictions</span><span class="p">[</span><span class="s">&#39;proba&#39;</span><span class="p">][</span><span class="n">ID</span><span class="o">+</span><span class="n">ID_CV</span><span class="p">]</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="nb">print</span> <span class="n">predictions</span><span class="p">[</span><span class="s">&#39;pred&#39;</span><span class="p">][</span><span class="n">ID_CV</span><span class="p">:</span><span class="n">ID_CV</span><span class="o">+</span><span class="n">ID</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">testcv</span><span class="p">])</span>
        <span class="n">accur_res</span><span class="o">=</span><span class="n">eval_accuracy</span><span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="s">&#39;pred&#39;</span><span class="p">][</span><span class="n">ID_CV</span><span class="p">:</span><span class="n">ID_CV</span><span class="o">+</span><span class="n">ID</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">labels</span><span class="p">[</span><span class="n">testcv</span><span class="p">],</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">ID_CV</span><span class="o">+=</span><span class="n">ID</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">accur_res</span><span class="p">)</span>
        <span class="c">#print len(results)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predictions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;error&#39;</span><span class="p">]</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="s">&quot;Image ID=%d , actual=%s , pred=%s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;image_id&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;actual&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;pred&#39;</span><span class="p">])</span>


    <span class="n">corr_rate</span><span class="p">,</span><span class="n">wrong_rate</span><span class="o">=</span><span class="n">average_cv_stats</span><span class="p">(</span><span class="n">results</span><span class="p">,</span><span class="n">labels</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span><span class="n">corr_rate</span><span class="p">,</span><span class="n">wrong_rate</span></div>


<div class="viewcode-block" id="do_prediction"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.do_prediction">[docs]</a><span class="k">def</span> <span class="nf">do_prediction</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">train_set_features</span><span class="p">,</span><span class="n">train_set_labels</span><span class="p">,</span><span class="n">test_set_features</span><span class="p">,</span><span class="n">test_set_labels</span><span class="p">,</span><span class="n">test_set_original_id</span><span class="p">,</span><span class="n">labels_num</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>





        <span class="n">prediction_dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([(</span><span class="s">&#39;image_id&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),(</span><span class="s">&#39;actual&#39;</span><span class="p">,</span> <span class="s">&#39;S16&#39;</span><span class="p">),(</span><span class="s">&#39;pred&#39;</span><span class="p">,</span> <span class="s">&#39;S16&#39;</span><span class="p">),(</span><span class="s">&#39;error&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">),(</span><span class="s">&#39;proba&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="n">labels_num</span><span class="p">,))])</span>
        <span class="n">predictions</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">test_set_labels</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">prediction_dtype</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s">&#39;predict_proba_ll&#39;</span><span class="p">):</span>
            <span class="nb">print</span><span class="s">&#39;predict proba&#39;</span>
            <span class="n">pred</span><span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_set_features</span><span class="p">,</span> <span class="n">train_set_labels</span><span class="p">)</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">test_set_features</span><span class="p">)</span>
            <span class="n">pred_class</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_set_features</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#model.fit(train_set_features, train_set_labels)</span>
            <span class="nb">print</span> <span class="s">&quot;NOT FITTING&quot;</span>
            <span class="n">pred_class</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_set_features</span><span class="p">)</span>
            <span class="n">pred</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">test_set_labels</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">classes_</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">ID_1</span><span class="p">,</span><span class="n">pc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pred_class</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">ID_2</span><span class="p">,</span><span class="n">model_c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">classes_</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">pc</span><span class="o">==</span><span class="n">model_c</span><span class="p">:</span>
                        <span class="n">pred</span><span class="p">[</span><span class="n">ID_1</span><span class="p">][</span><span class="n">ID_2</span><span class="p">]</span><span class="o">=</span><span class="mf">1.0</span>


        <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pred</span><span class="p">):</span>

            <span class="n">pmax_id</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

            <span class="c">#print p,pred_class[ID]</span>
            <span class="c">#print p, pmax_id, model.classes_[pmax_id]</span>
            <span class="c">#print ID,len(pred),test_set_labels.size</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pred_class</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="o">==</span><span class="n">test_set_labels</span><span class="p">[</span><span class="n">ID</span><span class="p">])</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
                <span class="n">c</span><span class="o">=</span><span class="s">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">c</span><span class="o">=</span><span class="s">&#39;+&#39;</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
                <span class="nb">print</span>  <span class="s">&quot;ID= %4d&quot;</span><span class="o">%</span><span class="n">test_set_original_id</span><span class="p">[</span><span class="n">ID</span><span class="p">],</span> <span class="s">&#39;actual &#39;</span><span class="p">,</span><span class="n">test_set_labels</span><span class="p">[</span><span class="n">ID</span><span class="p">],</span> <span class="s">&#39;pred=&#39;</span><span class="p">,</span><span class="n">pred_class</span><span class="p">[</span><span class="n">pmax_id</span><span class="p">],</span> <span class="s">&#39;error &#39;</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="s">&#39; proba&#39;</span><span class="p">,</span><span class="n">p</span>

            <span class="n">predictions</span><span class="p">[</span><span class="s">&#39;image_id&#39;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span><span class="o">=</span><span class="n">test_set_original_id</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span>
            <span class="n">predictions</span><span class="p">[</span><span class="s">&#39;actual&#39;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span><span class="o">=</span><span class="n">test_set_labels</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span>
            <span class="n">predictions</span><span class="p">[</span><span class="s">&#39;pred&#39;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span><span class="o">=</span><span class="n">pred_class</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span>
            <span class="n">predictions</span><span class="p">[</span><span class="s">&#39;error&#39;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span><span class="o">=</span><span class="n">pred</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="o">!=</span><span class="n">test_set_labels</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span>
            <span class="n">predictions</span><span class="p">[</span><span class="s">&#39;proba&#39;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span><span class="o">=</span><span class="n">p</span>


        <span class="n">eval_accuracy</span><span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="s">&#39;pred&#39;</span><span class="p">]</span>   <span class="p">,</span><span class="n">test_set_labels</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">predictions</span></div>


<div class="viewcode-block" id="DataSet"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet">[docs]</a><span class="k">class</span> <span class="nc">DataSet</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">data_sets_list</span><span class="o">=</span><span class="p">[],</span><span class="n">class_labels_list</span><span class="o">=</span><span class="p">[],</span><span class="n">ID_field_name</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="n">shuffle</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="n">classifier</span><span class="o">=</span><span class="s">&#39;rfc&#39;</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_labels_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">check_is_list</span><span class="p">(</span><span class="n">class_labels_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_sets_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">check_is_list</span><span class="p">(</span><span class="n">data_sets_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="o">=</span><span class="k">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ID_field_name</span><span class="o">=</span><span class="n">ID_field_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">originals_ID</span><span class="o">=</span><span class="k">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">data_sets_list</span><span class="p">,</span><span class="n">shuffle</span><span class="o">=</span><span class="n">shuffle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classifier_name</span><span class="o">=</span><span class="n">classifier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators</span>


<div class="viewcode-block" id="DataSet.set_classifier"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.set_classifier">[docs]</a>    <span class="k">def</span> <span class="nf">set_classifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">classifier_name</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">classifier_name</span><span class="o">==</span><span class="k">None</span><span class="p">:</span>
            <span class="n">classifier_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier_name</span>

        <span class="k">if</span> <span class="n">classifier_name</span><span class="o">==</span><span class="s">&#39;RFC&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">=</span><span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_estimators</span><span class="p">,</span><span class="n">oob_score</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">classifier_name</span><span class="o">==</span><span class="s">&#39;AdaBoost&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">=</span><span class="n">AdaBoostClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_estimators</span><span class="p">,</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.025</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">classifier_name</span><span class="o">==</span><span class="s">&#39;GradientBoosting&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">=</span><span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_estimators</span><span class="p">,</span><span class="n">warm_start</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>  <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">subsample</span><span class="o">=</span><span class="mf">1.0</span>  <span class="p">)</span>
        <span class="k">elif</span> <span class="n">classifier_name</span><span class="o">==</span><span class="s">&#39;ExtraTrees&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">=</span><span class="n">ExtraTreesClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_estimators</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">classifier_name</span><span class="o">==</span><span class="s">&#39;DecisionTree&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">=</span><span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">classifier_name</span><span class="o">==</span><span class="s">&#39;GaussianNB&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">=</span><span class="n">GaussianNB</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">classifier_name</span><span class="o">==</span><span class="s">&#39;SGDC&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">=</span><span class="n">SGDClassifier</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s">&quot;log&quot;</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="s">&quot;l2&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">classifier_name</span><span class="o">==</span><span class="s">&#39;LDA&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">=</span><span class="n">LDA</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s">&#39;svd&#39;</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mf">0.00000000001</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">classifier_name</span><span class="o">==</span><span class="s">&#39;QDA&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">=</span><span class="n">QDA</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">classifier_name</span><span class="o">==</span><span class="s">&#39;KN&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">=</span><span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">algorithm</span><span class="o">=</span><span class="s">&#39;auto&#39;</span><span class="p">,</span> <span class="n">leaf_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s">&#39;minkowski&#39;</span><span class="p">,</span>
               <span class="n">metric_params</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s">&#39;uniform&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">classifier_name</span><span class="o">==</span><span class="s">&#39;KD&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">=</span><span class="n">KernelDensity</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">classifier_name</span><span class="o">==</span><span class="s">&#39;LogReg&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">=</span><span class="n">LogisticRegression</span><span class="p">(</span><span class="n">penalty</span><span class="o">=</span><span class="s">&#39;L2&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">classifier_name</span><span class="o">==</span><span class="s">&#39;LinearSVC&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">=</span><span class="n">LinearSVC</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s">&#39;l2&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">classifier_name</span><span class="o">==</span><span class="s">&#39;SVC&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">=</span><span class="n">SVC</span><span class="p">(</span><span class="n">probability</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s">&#39;rbf&#39;</span>    <span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">classifier_name</span><span class="o">==</span><span class="s">&#39;Neural&#39;</span><span class="p">:</span>
            <span class="n">classifier</span> <span class="o">=</span><span class="n">LDA</span><span class="p">()</span>
            <span class="n">rbm</span> <span class="o">=</span> <span class="n">BernoulliRBM</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">learning_rate</span><span class="o">=</span><span class="mi">1</span><span class="n">E</span><span class="o">-</span><span class="mi">13</span><span class="p">,</span><span class="n">n_components</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span><span class="n">n_iter</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rbm</span><span class="o">=</span><span class="n">rbm</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s">&#39;rbm&#39;</span><span class="p">,</span> <span class="n">rbm</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">classifier</span><span class="p">)])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;classifier %s not supported&#39;</span><span class="o">%</span><span class="n">classifier_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s">&quot;Model&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span></div>


<div class="viewcode-block" id="DataSet.check_is_list"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.check_is_list">[docs]</a>    <span class="k">def</span> <span class="nf">check_is_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">l</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;set list is not a list &quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSet.split_test_set"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.split_test_set">[docs]</a>    <span class="k">def</span> <span class="nf">split_test_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">test_fraction</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="n">image_ids</span><span class="o">=</span><span class="p">[]):</span>
        <span class="n">test_set</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">test_set</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;test&#39;</span>
        <span class="k">if</span> <span class="n">test_fraction</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
            <span class="n">rnd_id</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">rnd_id</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">rnd_id</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">rnd_id</span><span class="p">)</span>
            <span class="n">split</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span><span class="o">*</span><span class="n">test_fraction</span><span class="p">)</span>

            <span class="n">test_ids</span><span class="o">=</span><span class="n">rnd_id</span><span class="p">[:</span><span class="n">split</span><span class="p">]</span>
            <span class="n">train_ids</span><span class="o">=</span><span class="n">rnd_id</span><span class="p">[</span><span class="n">split</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">test_ids</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;image_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">image_ids</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">train_ids</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;image_id&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">image_ids</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">select_features_ids</span><span class="p">(</span><span class="n">train_ids</span><span class="p">)</span>
        <span class="n">test_set</span><span class="o">.</span><span class="n">select_features_ids</span><span class="p">(</span><span class="n">test_ids</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">test_set</span></div>

<div class="viewcode-block" id="DataSet.build"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data_sets_list</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="n">class_labels_list</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="n">shuffle</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="n">features_names</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data_sets_list</span><span class="o">==</span><span class="k">None</span><span class="p">:</span>
            <span class="n">data_sets_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_sets_list</span>

        <span class="k">if</span> <span class="n">class_labels_list</span><span class="o">==</span><span class="k">None</span><span class="p">:</span>
            <span class="n">class_labels_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">class_labels_list</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="o">=</span><span class="p">[]</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data_sets_list</span><span class="p">)</span><span class="o">==</span><span class="p">():</span>
            <span class="n">data_sets_list</span><span class="o">=</span><span class="p">[</span><span class="n">data_sets_list</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">class_labels_list</span><span class="p">)</span><span class="o">==</span><span class="p">():</span>
            <span class="n">class_labels_list</span><span class="o">=</span><span class="p">[</span><span class="n">class_labels_list</span><span class="p">]</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">stack_arrays</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_sets_list</span><span class="p">,</span><span class="n">asrecarray</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s">&quot;---&gt;&quot;</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">features_names</span><span class="o">==</span><span class="k">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>


        <span class="n">data_list</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">label_set</span><span class="p">,</span><span class="n">data_set</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">class_labels_list</span><span class="p">,</span><span class="n">data_sets_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">label_set</span><span class="p">)</span><span class="o">==</span><span class="p">():</span>
                <span class="n">label_set</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">label_set</span><span class="p">]</span><span class="o">*</span><span class="n">data_set</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">label_set</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span>
        <span class="n">rows</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cols</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;image_id&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">:</span>
            <span class="n">cols</span><span class="o">+=</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">recfunctions</span><span class="o">.</span><span class="n">append_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="s">&#39;image_id&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">rows</span><span class="p">),</span><span class="n">usemask</span><span class="o">=</span><span class="k">False</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;image_id&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">rows</span><span class="p">,</span><span class="n">cols</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[:,</span><span class="n">ID</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_types</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">class_types</span><span class="o">.</span><span class="n">size</span>

        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span><span class="p">,</span><span class="n">foo</span><span class="p">)</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID_field_name</span><span class="o">==</span><span class="k">None</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">originals_ID</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">originals_ID</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ID_field_name</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">shuffle</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shuffle_set</span><span class="p">()</span></div>




<div class="viewcode-block" id="DataSet.do_feat_std"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.do_feat_std">[docs]</a>    <span class="k">def</span>  <span class="nf">do_feat_std</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">print</span> <span class="s">&quot;features Standardization&quot;</span>
            <span class="kn">from</span> <span class="nn">sklearn</span> <span class="k">import</span> <span class="n">preprocessing</span>

            <span class="n">std_scale</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">std_scale</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSet.do_pca"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.do_pca">[docs]</a>    <span class="k">def</span>  <span class="nf">do_pca</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">print</span> <span class="s">&quot;features PCA&quot;</span>
            <span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="k">import</span> <span class="n">PCA</span>

            <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">)</span>


            <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">feat_nane</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;pca_%d&#39;</span><span class="o">%</span><span class="n">ID</span></div>


<div class="viewcode-block" id="DataSet.class_mapping"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.class_mapping">[docs]</a>    <span class="k">def</span> <span class="nf">class_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">class_map_dic</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">class_map_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">msk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="o">==</span><span class="n">k</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span><span class="o">=</span><span class="n">class_map_dic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>


<div class="viewcode-block" id="DataSet.get_feature"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.get_feature">[docs]</a>    <span class="k">def</span> <span class="nf">get_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">feature_name</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="k">None</span><span class="p">,</span><span class="k">None</span><span class="p">],</span><span class="n">get_image_id</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">feature_name</span> <span class="ow">in</span>  <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>



            <span class="n">d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span>
            <span class="n">ids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;image_id&#39;</span><span class="p">]</span>

            <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span>


            <span class="k">if</span> <span class="n">label</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
                <span class="n">msk</span><span class="o">=</span><span class="n">labels</span><span class="o">==</span><span class="n">label</span>
                <span class="n">d</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>
                <span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
                <span class="n">msk</span><span class="o">=</span><span class="n">d</span><span class="o">&gt;</span><span class="nb">range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">d</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>
                <span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
                <span class="n">msk</span><span class="o">=</span><span class="n">d</span><span class="o">&lt;</span><span class="nb">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">d</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>
                <span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s">&quot;no feature found with name&quot;</span><span class="p">,</span><span class="n">feature_name</span>
            <span class="nb">print</span> <span class="s">&quot;features names are&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
            <span class="n">d</span><span class="o">=</span><span class="k">None</span>
            <span class="n">ids</span><span class="o">=</span><span class="k">None</span>

        <span class="k">if</span> <span class="n">get_image_id</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">d</span><span class="p">,</span><span class="n">ids</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">d</span></div>


<div class="viewcode-block" id="DataSet.get_cv_feature"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.get_cv_feature">[docs]</a>    <span class="k">def</span> <span class="nf">get_cv_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">feature_name</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="k">None</span><span class="p">,</span><span class="k">None</span><span class="p">],</span><span class="n">get_image_id</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">predicted</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="n">actual</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="n">cv_predictions</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">feature_name</span> <span class="ow">in</span>  <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>



            <span class="k">if</span> <span class="n">cv_predictions</span><span class="o">==</span><span class="k">None</span><span class="p">:</span>
                <span class="n">cv_predictions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_predictions</span>


            <span class="k">if</span> <span class="n">predicted</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
                <span class="n">cv_predictions</span><span class="o">=</span><span class="n">cv_predictions</span><span class="p">[</span><span class="n">cv_predictions</span><span class="p">[</span><span class="s">&#39;pred&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">predicted</span><span class="p">]</span>
                <span class="c">#print cv_predictions.size</span>
            <span class="k">if</span> <span class="n">actual</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
                <span class="n">cv_predictions</span><span class="o">=</span><span class="n">cv_predictions</span><span class="p">[</span><span class="n">cv_predictions</span><span class="p">[</span><span class="s">&#39;actual&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">actual</span><span class="p">]</span>
                <span class="c">#print cv_predictions.size</span>

            <span class="c">#select form data all the rows where image_id==image_id in cv_prediction 2d-array</span>
            <span class="n">cv_images_ids</span><span class="o">=</span><span class="n">cv_predictions</span><span class="p">[</span><span class="s">&#39;image_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">cv_predictions</span><span class="p">[</span><span class="s">&#39;image_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="c">#print ids</span>
            <span class="c">#print np.where(self.data[&#39;image_id&#39;]==ids)</span>
            <span class="n">featuare_value_ids</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;image_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">cv_images_ids</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">featuare_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">feature_name</span><span class="p">],</span><span class="n">featuare_value_ids</span><span class="p">)</span>
            <span class="n">image_ids</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;image_id&#39;</span><span class="p">],</span><span class="n">featuare_value_ids</span><span class="p">)</span>
            <span class="nb">print</span> <span class="nb">range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
                <span class="n">msk</span><span class="o">=</span><span class="n">featuare_values</span><span class="o">&gt;</span><span class="nb">range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">featuare_values</span><span class="o">=</span><span class="n">featuare_values</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>
                <span class="n">image_ids</span><span class="o">=</span><span class="n">image_ids</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>
                <span class="c">#print featuare_values</span>
            <span class="k">if</span> <span class="nb">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
                <span class="n">msk</span><span class="o">=</span><span class="n">featuare_values</span><span class="o">&lt;</span><span class="nb">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">featuare_values</span><span class="o">=</span><span class="n">featuare_values</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>
                <span class="n">image_ids</span><span class="o">=</span><span class="n">image_ids</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>



        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s">&quot;no feature found with name&quot;</span><span class="p">,</span><span class="n">feature_name</span>
            <span class="nb">print</span> <span class="s">&quot;features names are&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
            <span class="n">featuare_values</span><span class="o">=</span><span class="k">None</span>
            <span class="n">image_ids</span><span class="o">=</span><span class="k">None</span>

        <span class="k">if</span> <span class="n">get_image_id</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">featuare_values</span><span class="p">,</span><span class="n">image_ids</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">featuare_values</span></div>

<div class="viewcode-block" id="DataSet.shuffle_set"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.shuffle_set">[docs]</a>    <span class="k">def</span> <span class="nf">shuffle_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">foo</span><span class="p">)</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">rnd_id</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">rnd_id</span><span class="p">)</span>
        <span class="c">#print &quot;shuffle,&quot;,rnd_id.shape,np.unique(rnd_id).shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_features_ids</span><span class="p">(</span><span class="n">rnd_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataSet.show_features"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.show_features">[docs]</a>    <span class="k">def</span> <span class="nf">show_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">image_id</span><span class="p">):</span>

        <span class="n">d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;image_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">image_id</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">feat_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="nb">print</span> <span class="n">feat_name</span><span class="p">,</span><span class="s">&#39;=&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="n">feat_name</span><span class="p">]</span></div>

<div class="viewcode-block" id="DataSet.skip_features"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.skip_features">[docs]</a>    <span class="k">def</span> <span class="nf">skip_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">del_names</span><span class="p">):</span>

        <span class="c">#print del_names</span>
        <span class="n">use_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">[:]</span>
        <span class="k">for</span> <span class="n">del_name</span> <span class="ow">in</span> <span class="n">del_names</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">use_list</span><span class="p">[:]:</span>
                <span class="k">if</span> <span class="n">del_name</span> <span class="ow">in</span> <span class="n">name</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">del_name</span><span class="p">)]:</span>
                    <span class="c">#print &quot;removing &quot;,name,len(use_list)</span>
                    <span class="n">use_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c">#print self.features_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_features</span><span class="p">(</span><span class="n">use_list</span><span class="p">)</span></div>

        <span class="c">#self.build( shuffle=False)</span>

<div class="viewcode-block" id="DataSet.use_features"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.use_features">[docs]</a>    <span class="k">def</span> <span class="nf">use_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_names</span><span class="p">,</span><span class="n">whole_name</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s">&quot;feture before filtering&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">)</span>
        <span class="n">use_list</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">use_name</span> <span class="ow">in</span> <span class="n">use_names</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">whole_name</span><span class="o">==</span><span class="k">False</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">use_name</span> <span class="ow">in</span> <span class="n">name</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">use_name</span><span class="p">)]:</span>
                        <span class="n">use_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">use_name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                        <span class="n">use_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span>
                    <span class="c">#print &quot;using &quot;,name,use_list</span>

        <span class="n">use_list</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">use_list</span><span class="p">)</span>
        <span class="n">use_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">use_names</span><span class="o">=</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">use_list</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="o">=</span><span class="n">use_names</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[:,</span><span class="n">use_list</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[:,</span><span class="n">use_list</span><span class="p">]</span>
        <span class="nb">print</span> <span class="s">&quot;features left&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="DataSet.skip_images_id"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.skip_images_id">[docs]</a>    <span class="k">def</span> <span class="nf">skip_images_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ids</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s">&quot;skip images ids&quot;</span>

        <span class="nb">print</span> <span class="s">&quot;size pre-filtering&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">ids</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">data_ids</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;image_id&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">ids</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_features_ids</span><span class="p">(</span><span class="n">data_ids</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s">&quot;size post-filtering&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span></div>

<div class="viewcode-block" id="DataSet.skip_classes"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.skip_classes">[docs]</a>    <span class="k">def</span> <span class="nf">skip_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">skip_classes</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">sk_c</span> <span class="ow">in</span> <span class="n">skip_classes</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s">&quot;skipping&quot;</span><span class="p">,</span> <span class="n">sk_c</span>
            <span class="n">msk_good</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="o">!=</span><span class="n">sk_c</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_features_ids</span><span class="p">(</span><span class="n">msk_good</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">class_types</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">class_types</span><span class="o">.</span><span class="n">size</span></div>

<div class="viewcode-block" id="DataSet.filter_nan"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.filter_nan">[docs]</a>    <span class="k">def</span> <span class="nf">filter_nan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s">&quot;filtering nan&quot;</span>
        <span class="n">msk</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>

        <span class="nb">print</span> <span class="s">&quot;size pre-filtering&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">for</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span><span class="p">):</span>
            <span class="c">#print type( self.features[ID]),np.shape(self.features[ID]),self.features[ID]</span>
            <span class="c">#print self.features[ID][0]</span>

            <span class="n">msk</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="o">=</span><span class="k">True</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">ID</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
                    <span class="n">msk</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="o">=</span><span class="k">False</span>

                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
                    <span class="n">msk</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="o">=</span><span class="k">False</span>

            <span class="c">#msk[ID]=np.isfinite(a).all()</span>
            <span class="c">#if np.isfinite(self.features[ID]).all()==False:</span>
            <span class="c">#    print ID</span>


        <span class="c">#print self.originals_ID[msk]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_features_ids</span><span class="p">(</span><span class="n">msk</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s">&quot;size post-filtering&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span>
        <span class="nb">print</span></div>


<div class="viewcode-block" id="DataSet.select_features_ids"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.select_features_ids">[docs]</a>    <span class="k">def</span> <span class="nf">select_features_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ids</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s">&quot;select features ids,&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">originals_ID</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">originals_ID</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
        <span class="nb">print</span> <span class="s">&quot;pre selection shape&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">ids</span><span class="p">]</span>
        <span class="nb">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">originals_ID</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">originals_ID</span><span class="p">[</span><span class="n">ids</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="p">[</span><span class="n">ids</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ids</span><span class="p">]</span>

        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span><span class="p">,</span><span class="n">foo</span><span class="p">)</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span>
        <span class="nb">print</span> <span class="s">&quot;post selection shape&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span>
        <span class="nb">print</span> <span class="s">&quot;select features ids,&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">originals_ID</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">originals_ID</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
        <span class="nb">print</span></div>

<div class="viewcode-block" id="DataSet.write_weka_file"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.write_weka_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_weka_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_name</span><span class="p">):</span>
        <span class="n">write_weka_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="p">)</span></div>




<div class="viewcode-block" id="DataSet.plot_feature_correlation_matrix"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.plot_feature_correlation_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">plot_feature_correlation_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;./&#39;</span> <span class="p">):</span>
        <span class="n">plot_feature_correlation_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span> <span class="p">)</span></div>

<div class="viewcode-block" id="DataSet.find_most_corr_features"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.find_most_corr_features">[docs]</a>    <span class="k">def</span> <span class="nf">find_most_corr_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">feature_name</span><span class="p">):</span>
        <span class="nb">id</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">)</span><span class="o">==</span><span class="n">feature_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_names</span>
        <span class="nb">print</span> <span class="s">&quot;feature_id&quot;</span><span class="p">,</span><span class="n">feature_name</span><span class="p">,</span><span class="nb">id</span>
        <span class="n">c_matr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span><span class="n">rowvar</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c">#print c_matr.shape</span>
        <span class="n">c_arr</span><span class="o">=</span><span class="n">c_matr</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
        <span class="nb">print</span> <span class="n">c_arr</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">c_arr</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">id_c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">c_arr</span><span class="p">))</span>

        <span class="nb">print</span> <span class="s">&quot;most corr feature&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">[</span><span class="n">id_c</span><span class="p">],</span><span class="n">c_arr</span><span class="p">[</span><span class="n">id_c</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">corr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">c_arr</span><span class="p">):</span>
            <span class="nb">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">[</span><span class="n">ID</span><span class="p">],</span><span class="n">corr</span></div>


<div class="viewcode-block" id="DataSet.remove_correlated_features"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.remove_correlated_features">[docs]</a>    <span class="k">def</span> <span class="nf">remove_correlated_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n_trees</span><span class="p">,</span><span class="n">max_corr</span><span class="p">,</span><span class="n">order_increasing</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;./&#39;</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="o">=</span><span class="n">remove_correlated_features</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="p">,</span><span class="n">max_corr</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s">&quot;features shape&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span>
        <span class="nb">print</span> <span class="s">&quot;features names len&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSet.do_cv_confusion_matrix"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.do_cv_confusion_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">do_cv_confusion_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;./&#39;</span> <span class="p">):</span>
        <span class="n">do_confusion_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_predictions</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSet.do_MC"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.do_MC">[docs]</a>    <span class="k">def</span> <span class="nf">do_MC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">MC_repl</span><span class="p">,</span><span class="n">n_trees</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MC_scores</span><span class="o">=</span> <span class="n">do_MC</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="p">,</span><span class="n">n_repl</span><span class="o">=</span><span class="n">MC_repl</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataSet.predict_test_set"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.predict_test_set">[docs]</a>    <span class="k">def</span> <span class="nf">predict_test_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">test_set</span><span class="p">):</span>
        <span class="n">test_set</span><span class="o">.</span><span class="n">use_features</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">)</span>
        <span class="n">test_set</span><span class="o">.</span><span class="n">predictions</span><span class="o">=</span><span class="n">do_prediction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="p">,</span><span class="n">test_set</span><span class="o">.</span><span class="n">features</span><span class="p">,</span><span class="n">test_set</span><span class="o">.</span><span class="n">class_labels</span><span class="p">,</span><span class="n">test_set</span><span class="o">.</span><span class="n">originals_ID</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">class_num</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="k">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataSet.find_best_tree_num"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.find_best_tree_num">[docs]</a>    <span class="k">def</span> <span class="nf">find_best_tree_num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;./&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">find_best_tree_num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_classifier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSet.get_cross_validation_score"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.get_cross_validation_score">[docs]</a>    <span class="k">def</span> <span class="nf">get_cross_validation_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataSet.do_cross_fold_validation"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.do_cross_fold_validation">[docs]</a>    <span class="k">def</span> <span class="nf">do_cross_fold_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n_folds</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s">&quot;fatures num&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_predictions</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_corr_rate</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_wrong_rate</span><span class="o">=</span><span class="n">do_cross_fold_validation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">class_num</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;image_id&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">n_folds</span><span class="o">=</span><span class="n">n_folds</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_predictions</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataSet.print_cv_predictions"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.print_cv_predictions">[docs]</a>    <span class="k">def</span> <span class="nf">print_cv_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_predictions</span><span class="p">:</span>
            <span class="nb">print</span> <span class="n">p</span></div>

<div class="viewcode-block" id="DataSet.cv_predictions_errors"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.cv_predictions_errors">[docs]</a>    <span class="k">def</span> <span class="nf">cv_predictions_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label_class</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">label_class</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
            <span class="n">label_class</span><span class="o">=</span><span class="p">[</span><span class="n">label_class</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_types</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s">&quot;class&quot;</span><span class="p">,</span><span class="n">label</span>
            <span class="n">msk_class</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_predictions</span><span class="p">[</span><span class="s">&#39;actual&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">label</span>
            <span class="n">msk_err</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_predictions</span><span class="p">[</span><span class="s">&#39;error&#39;</span><span class="p">]</span><span class="o">==</span><span class="k">True</span>
            <span class="nb">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_predictions</span><span class="p">[</span><span class="s">&#39;image_id&#39;</span><span class="p">][</span><span class="n">msk_err</span><span class="o">*</span><span class="n">msk_class</span><span class="p">]</span>
            <span class="nb">print</span></div>




<div class="viewcode-block" id="DataSet.recursive_features_elimination"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.recursive_features_elimination">[docs]</a>    <span class="k">def</span> <span class="nf">recursive_features_elimination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                       <span class="n">percentile_th</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                       <span class="n">feat_n_min</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                       <span class="n">path</span><span class="o">=</span><span class="s">&#39;./&#39;</span><span class="p">,</span>
                                       <span class="n">plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
                                       <span class="n">save_plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
                                       <span class="n">file_type</span><span class="o">=</span><span class="s">&#39;pdf&#39;</span><span class="p">,</span>
                                       <span class="n">file_name</span><span class="o">=</span><span class="s">&#39;rec_feat_rem&#39;</span><span class="p">):</span>

        <span class="n">best_feat</span><span class="o">=</span><span class="n">recursive_features_elimination</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="p">,</span>
                                       <span class="n">percentile_th</span><span class="o">=</span><span class="n">percentile_th</span><span class="p">,</span>
                                       <span class="n">feat_n_min</span><span class="o">=</span><span class="n">feat_n_min</span><span class="p">,</span>
                                       <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
                                       <span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span>
                                       <span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span>
                                       <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span>
                                       <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">)</span>

        <span class="n">file_name</span><span class="o">=</span><span class="s">&#39;feat_imp_post_rec_rem&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_features</span><span class="p">(</span><span class="n">best_feat</span><span class="p">,</span><span class="n">whole_name</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features_importance</span><span class="p">,</span><span class="n">sorted_idx</span><span class="p">,</span><span class="n">important_features_ID</span><span class="o">=</span><span class="n">eval_features_importance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">,</span><span class="n">sort</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
        <span class="n">plot_fetures_importance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features_importance</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span><span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">)</span>
        <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features_importance</span><span class="p">,</span><span class="n">path</span><span class="o">+</span><span class="s">&#39;/feat_imp_post_rec_feat_rem.pkl&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSet.eval_features_importance"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.eval_features_importance">[docs]</a>    <span class="k">def</span> <span class="nf">eval_features_importance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sort</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;./&#39;</span><span class="p">,</span><span class="n">file_type</span><span class="o">=</span><span class="s">&#39;pdf&#39;</span><span class="p">,</span><span class="n">file_name</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">features_importance</span><span class="p">,</span><span class="n">sorted_idx</span><span class="p">,</span><span class="n">important_features_ID</span><span class="o">=</span><span class="n">eval_features_importance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">,</span><span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file_name</span><span class="o">==</span><span class="k">None</span><span class="p">:</span>
            <span class="n">file_name</span><span class="o">=</span><span class="s">&#39;feat_imp_no_filtered&#39;</span>
        <span class="n">th</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">features_importance</span><span class="p">[</span><span class="s">&#39;imp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="c">#use_list=[]</span>
        <span class="c">#for i in self.features_importance:</span>
        <span class="c">#    if i[&#39;imp&#39;]&gt;th:</span>
        <span class="c">#        use_list.append(i[&#39;name&#39;])</span>

        <span class="c">#self.use_features(use_list,whole_name=True)</span>
        <span class="c">#self.model.fit(self.features,self.class_labels)</span>
        <span class="n">plot_fetures_importance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features_importance</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span><span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">)</span>
        <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features_importance</span><span class="p">,</span><span class="n">path</span><span class="o">+</span><span class="s">&#39;/feat_imp.pkl&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataSet.do_features_importance_trend"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.do_features_importance_trend">[docs]</a>    <span class="k">def</span> <span class="nf">do_features_importance_trend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n_trees</span><span class="p">,</span><span class="n">order_increasing</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;./&#39;</span><span class="p">,</span><span class="n">file_type</span><span class="o">=</span><span class="s">&#39;pdf&#39;</span><span class="p">):</span>
        <span class="n">features_importance_trend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="p">,</span><span class="n">n_trees</span><span class="p">,</span><span class="n">order_increasing</span><span class="o">=</span><span class="n">order_increasing</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataSet.plot_feature_histogram"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.plot_feature_histogram">[docs]</a>    <span class="k">def</span> <span class="nf">plot_feature_histogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">feature_name</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">KDE</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;./&#39;</span><span class="p">,</span><span class="n">file_type</span><span class="o">=</span><span class="s">&#39;pdf&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="n">exclude_outliers</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">feature_name</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_feature</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span>
                    <span class="k">return</span> <span class="n">plot_feature_histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="nb">range</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="n">normed</span><span class="p">,</span><span class="n">KDE</span><span class="o">=</span><span class="n">KDE</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">exclude_outliers</span><span class="o">=</span><span class="n">exclude_outliers</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">:</span>
                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_feature</span><span class="p">(</span><span class="n">feature_name</span><span class="p">)</span>
                <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span>
                <span class="k">return</span> <span class="n">plot_feature_histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">feature_name</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="nb">range</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="n">normed</span><span class="p">,</span><span class="n">KDE</span><span class="o">=</span><span class="n">KDE</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">exclude_outliers</span><span class="o">=</span><span class="n">exclude_outliers</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSet.plot_cv_feature_histogram"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.plot_cv_feature_histogram">[docs]</a>    <span class="k">def</span> <span class="nf">plot_cv_feature_histogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">feature_name</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">cv_error</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">cv_predictions</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cv_predictions</span><span class="o">==</span><span class="k">None</span><span class="p">:</span>
            <span class="n">cv_predictions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_predictions</span>

        <span class="k">if</span> <span class="n">feature_name</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cv_feature</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">cv_predictions</span><span class="o">=</span><span class="n">cv_predictions</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">cv_error</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
                        <span class="n">error</span><span class="o">=</span><span class="n">cv_predictions</span><span class="p">[</span><span class="s">&#39;error&#39;</span><span class="p">]</span>
                        <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;S16&#39;</span><span class="p">)</span>
                        <span class="n">labels</span><span class="p">[</span><span class="n">error</span><span class="o">==</span><span class="k">True</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;w&#39;</span>
                        <span class="n">labels</span><span class="p">[</span><span class="n">error</span><span class="o">!=</span><span class="k">True</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;r&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">labels</span><span class="o">=</span><span class="n">cv_predictions</span><span class="p">[</span><span class="s">&#39;pred&#39;</span><span class="p">]</span>

                    <span class="n">plot_feature_histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="nb">range</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="n">normed</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">:</span>
                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cv_feature</span><span class="p">(</span><span class="n">feature_name</span><span class="p">,</span><span class="n">cv_predictions</span><span class="o">=</span><span class="n">cv_predictions</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cv_error</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
                    <span class="n">error</span><span class="o">=</span><span class="n">cv_predictions</span><span class="p">[</span><span class="s">&#39;error&#39;</span><span class="p">]</span>
                    <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;S16&#39;</span><span class="p">)</span>
                    <span class="n">labels</span><span class="p">[</span><span class="n">error</span><span class="o">==</span><span class="k">True</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;w&#39;</span>
                    <span class="n">labels</span><span class="p">[</span><span class="n">error</span><span class="o">!=</span><span class="k">True</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;r&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">labels</span><span class="o">=</span><span class="n">cv_predictions</span><span class="p">[</span><span class="s">&#39;pred&#39;</span><span class="p">]</span>

                <span class="n">plot_feature_histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">feature_name</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="nb">range</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="n">normed</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSet.plot_feature_entropy"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.plot_feature_entropy">[docs]</a>    <span class="k">def</span> <span class="nf">plot_feature_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">feature_name</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;./&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">feature_name</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">do_plot_feature_entropy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_feature</span><span class="p">(</span><span class="n">name</span><span class="p">),</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="nb">range</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="n">normed</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">:</span>
                <span class="n">do_plot_feature_entropy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_feature</span><span class="p">(</span><span class="n">feature_name</span><span class="p">),</span><span class="n">feature_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="nb">range</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="n">normed</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span></div>



<div class="viewcode-block" id="DataSet.get_feature_cut"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.get_feature_cut">[docs]</a>    <span class="k">def</span> <span class="nf">get_feature_cut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">feature_name</span><span class="p">,</span><span class="n">feat_range</span><span class="p">):</span>
        <span class="n">msk</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_feature</span><span class="p">(</span><span class="n">feature_name</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">feat_range</span><span class="o">!=</span><span class="k">None</span> <span class="ow">or</span> <span class="n">feat_range</span><span class="o">!=</span><span class="p">[]:</span>
            <span class="k">if</span> <span class="n">feat_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
                <span class="n">msk1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_feature</span><span class="p">(</span><span class="n">feature_name</span><span class="p">)</span><span class="o">&gt;</span><span class="n">feat_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msk1</span><span class="o">=</span><span class="n">msk</span>
            <span class="k">if</span> <span class="n">feat_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
                <span class="n">msk2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_feature</span><span class="p">(</span><span class="n">feature_name</span><span class="p">)</span><span class="o">&lt;</span><span class="n">feat_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">msk2</span><span class="o">=</span><span class="n">msk</span>

            <span class="n">msk</span><span class="o">=</span><span class="n">msk1</span><span class="o">*</span><span class="n">msk2</span>

        <span class="k">return</span> <span class="n">msk</span></div>

<div class="viewcode-block" id="DataSet.plot_contour_scatter_plot"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.plot_contour_scatter_plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot_contour_scatter_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">feature_name_x</span><span class="p">,</span>
                                  <span class="n">feature_name_y</span><span class="p">,</span>
                                  <span class="n">H_cmap</span><span class="o">=</span><span class="s">&#39;summer_r&#39;</span><span class="p">,</span>
                                  <span class="n">n_levels</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                                  <span class="n">smoothing_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                  <span class="n">plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
                                  <span class="n">labels</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
                                  <span class="n">ax</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
                                  <span class="n">exclude_outliers</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
                                  <span class="n">plot_H</span><span class="o">=</span><span class="k">True</span><span class="p">,</span>
                                  <span class="n">plot_contour</span><span class="o">=</span><span class="k">True</span><span class="p">,</span>
                                  <span class="n">plot_scatter</span><span class="o">=</span><span class="k">True</span><span class="p">,</span>
                                  <span class="n">x_range</span><span class="o">=</span><span class="p">[</span><span class="k">None</span><span class="p">,</span><span class="k">None</span><span class="p">],</span>
                                  <span class="n">y_range</span><span class="o">=</span><span class="p">[</span><span class="k">None</span><span class="p">,</span><span class="k">None</span><span class="p">],</span>
                                  <span class="n">point_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                  <span class="n">color_list</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
                                  <span class="n">c_map_list</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
                                  <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                  <span class="n">classes</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>

        <span class="n">msk</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_feature</span><span class="p">(</span><span class="n">feature_name_x</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">x_range</span><span class="o">!=</span><span class="k">None</span> <span class="ow">or</span> <span class="n">x_range</span><span class="o">!=</span><span class="p">[]:</span>
            <span class="n">msk1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_feature_cut</span><span class="p">(</span><span class="n">feature_name_x</span><span class="p">,</span><span class="n">x_range</span><span class="p">)</span>
            <span class="n">msk</span><span class="o">=</span><span class="n">msk</span><span class="o">*</span><span class="n">msk1</span>

        <span class="k">if</span> <span class="n">y_range</span><span class="o">!=</span><span class="k">None</span> <span class="ow">or</span> <span class="n">y_range</span><span class="o">!=</span><span class="p">[]:</span>
            <span class="n">msk1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_feature_cut</span><span class="p">(</span><span class="n">feature_name_y</span><span class="p">,</span><span class="n">y_range</span><span class="p">)</span>
            <span class="n">msk</span><span class="o">=</span><span class="n">msk</span><span class="o">*</span><span class="n">msk1</span>


        <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_feature</span><span class="p">(</span><span class="n">feature_name_y</span><span class="p">)[</span><span class="n">msk</span><span class="p">]</span>
        <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_feature</span><span class="p">(</span><span class="n">feature_name_x</span><span class="p">)[</span><span class="n">msk</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">labels</span><span class="o">==</span><span class="k">None</span><span class="p">:</span>
            <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>
            <span class="n">class_types</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>
            <span class="n">class_types</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">classes</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
            <span class="n">class_types</span><span class="o">=</span><span class="n">classes</span>

        <span class="k">return</span> <span class="n">contour_scatter_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span>
                                    <span class="n">y</span><span class="p">,</span>
                                    <span class="n">labels</span><span class="p">,</span>
                                    <span class="n">class_types</span><span class="p">,</span>
                                    <span class="n">H_cmap</span><span class="o">=</span><span class="n">H_cmap</span><span class="p">,</span>
                                    <span class="n">x_name</span><span class="o">=</span><span class="n">feature_name_x</span><span class="p">,</span>
                                    <span class="n">y_name</span><span class="o">=</span><span class="n">feature_name_y</span><span class="p">,</span>
                                    <span class="n">n_levels</span><span class="o">=</span><span class="n">n_levels</span><span class="p">,</span>
                                    <span class="n">smoothing_scale</span><span class="o">=</span><span class="n">smoothing_scale</span><span class="p">,</span>
                                    <span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span>
                                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                                    <span class="n">exclude_outliers</span><span class="o">=</span><span class="n">exclude_outliers</span><span class="p">,</span>
                                    <span class="n">plot_H</span><span class="o">=</span><span class="n">plot_H</span><span class="p">,</span>
                                    <span class="n">plot_contour</span><span class="o">=</span><span class="n">plot_contour</span><span class="p">,</span>
                                    <span class="n">plot_scatter</span><span class="o">=</span><span class="n">plot_scatter</span><span class="p">,</span>
                                    <span class="n">point_size</span><span class="o">=</span><span class="n">point_size</span><span class="p">,</span>
                                    <span class="n">color_list</span><span class="o">=</span><span class="n">color_list</span><span class="p">,</span>
                                    <span class="n">c_map_list</span><span class="o">=</span><span class="n">c_map_list</span><span class="p">,</span>
                                    <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSet.decision_tree_pre_filter"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.decision_tree_pre_filter">[docs]</a>    <span class="k">def</span> <span class="nf">decision_tree_pre_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">th</span><span class="o">=</span><span class="mf">0.75</span><span class="p">):</span>
        <span class="n">black_list</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">feature_name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">):</span>
            <span class="nb">print</span> <span class="s">&quot;feature&quot;</span><span class="p">,</span><span class="n">feature_name</span>
            <span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_feature</span><span class="p">(</span><span class="n">feature_name</span><span class="p">)</span>
            <span class="n">clf</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s">&quot;entropy&quot;</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">lab</span><span class="o">==</span> <span class="s">&#39;S&#39;</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">lab</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="p">])</span>
            <span class="c">#print y</span>
            <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
            <span class="nb">print</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

            <span class="n">score</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="nb">print</span> <span class="s">&quot;score&quot;</span><span class="p">,</span><span class="n">score</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">score</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">&lt;</span><span class="n">th</span><span class="p">:</span>
                <span class="n">black_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">skip_features</span><span class="p">(</span><span class="n">black_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSet.entroy_pre_filter"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.DataSet.entroy_pre_filter">[docs]</a>    <span class="k">def</span> <span class="nf">entroy_pre_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">th</span><span class="o">=</span><span class="mf">0.75</span><span class="p">):</span>
        <span class="n">black_list</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">feature_name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features_names</span><span class="p">):</span>

            <span class="n">H_gain</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">bin_edges</span><span class="o">=</span><span class="n">eval_feature_entropy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_feature</span><span class="p">(</span><span class="n">feature_name</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">class_labels</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="k">None</span><span class="p">)</span>

            <span class="nb">print</span> <span class="s">&quot;feature&quot;</span><span class="p">,</span><span class="n">feature_name</span><span class="p">,</span><span class="s">&#39;H gain&#39;</span><span class="p">,</span><span class="n">H_gain</span>


            <span class="k">if</span> <span class="n">H_gain</span><span class="o">&lt;</span><span class="n">th</span><span class="p">:</span>
                <span class="n">black_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">skip_features</span><span class="p">(</span><span class="n">black_list</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="run"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.run">[docs]</a><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">training_set_data_list</span><span class="p">,</span><span class="n">training_set_labels_list</span><span class="p">,</span><span class="n">test_set_data_list</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="n">test_set_labels_list</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
        <span class="n">test_set_split_fraction</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
        <span class="n">test_set_split_ids</span><span class="o">=</span><span class="k">None</span>     <span class="p">,</span>
        <span class="n">skip_attr</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">use_attr</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">skip_class</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">skip_images_ids</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
        <span class="n">classifier</span><span class="o">=</span><span class="s">&#39;RFC&#39;</span><span class="p">,</span>
        <span class="n">skip_nan_entries</span><span class="o">=</span><span class="k">True</span><span class="p">,</span>
        <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">do_pca</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
        <span class="n">do_feat_std</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
        <span class="n">eval_best_tree_num</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
        <span class="n">eval_feature_importance</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
        <span class="n">eval_feature_importance_trend</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
        <span class="n">feature_correlation_matrix</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
        <span class="n">cross_fold_N</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
        <span class="n">MC_repl</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
        <span class="n">max_par_corr</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
        <span class="n">feature_name</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
        <span class="n">feature_min</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
        <span class="n">feature_max</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
        <span class="n">test_th</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
        <span class="n">entropy_th</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
        <span class="n">class_mapping_dic</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
        <span class="n">select_features_ids</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
        <span class="n">plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
        <span class="n">save_plot</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
        <span class="n">roc_test_class</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
        <span class="n">cv_conf_matrix</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
        <span class="n">path</span><span class="o">=</span><span class="s">&#39;./&#39;</span><span class="p">):</span>






    <span class="n">data_sets_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">training_set</span><span class="o">=</span><span class="n">DataSet</span><span class="p">(</span><span class="s">&#39;training&#39;</span><span class="p">,</span><span class="n">training_set_data_list</span><span class="p">,</span><span class="n">training_set_labels_list</span><span class="p">,</span><span class="n">classifier</span><span class="o">=</span><span class="n">classifier</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators</span><span class="p">,)</span>

    <span class="k">if</span> <span class="n">class_mapping_dic</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
        <span class="n">training_set</span><span class="o">.</span><span class="n">class_mapping</span><span class="p">(</span><span class="n">class_mapping_dic</span><span class="p">)</span>
    <span class="nb">print</span><span class="s">&quot;training_set&quot;</span><span class="p">,</span> <span class="n">training_set</span><span class="o">.</span><span class="n">originals_ID</span><span class="o">.</span><span class="n">shape</span>
    <span class="nb">print</span><span class="s">&quot;training_set&quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">training_set</span><span class="o">.</span><span class="n">originals_ID</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>


    <span class="n">data_sets_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">test_set_data_list</span><span class="o">!=</span><span class="k">None</span> <span class="ow">and</span> <span class="n">test_set_labels_list</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
        <span class="n">test_set</span><span class="o">=</span><span class="n">DataSet</span><span class="p">(</span><span class="s">&#39;test&#39;</span><span class="p">,</span><span class="n">test_set_data_list</span><span class="p">,</span><span class="n">test_set_labels_list</span><span class="p">,</span><span class="n">classifier</span><span class="o">=</span><span class="n">classifier</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators</span><span class="p">)</span>
        <span class="n">data_sets_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_set</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">test_set</span><span class="o">=</span><span class="k">None</span>

    <span class="k">if</span> <span class="n">test_set_split_fraction</span><span class="o">!=</span><span class="k">None</span> <span class="ow">and</span>  <span class="n">test_set_data_list</span><span class="o">==</span><span class="k">None</span> <span class="ow">and</span> <span class="n">test_set_labels_list</span><span class="o">==</span><span class="k">None</span><span class="p">:</span>
        <span class="n">test_set</span><span class="o">=</span><span class="n">training_set</span><span class="o">.</span><span class="n">split_test_set</span><span class="p">(</span><span class="n">test_set_split_fraction</span><span class="p">)</span>
        <span class="n">data_sets_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_set</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">test_set_split_ids</span><span class="o">!=</span><span class="k">None</span>  <span class="ow">and</span>  <span class="n">test_set_data_list</span><span class="o">==</span><span class="k">None</span> <span class="ow">and</span> <span class="n">test_set_labels_list</span><span class="o">==</span><span class="k">None</span><span class="p">:</span>
        <span class="n">test_set</span><span class="o">=</span><span class="n">training_set</span><span class="o">.</span><span class="n">split_test_set</span><span class="p">(</span><span class="n">image_ids</span><span class="o">=</span><span class="n">test_set_split_ids</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">select_features_ids</span><span class="o">!=</span><span class="k">None</span> <span class="ow">and</span> <span class="n">select_features_ids</span><span class="o">!=</span><span class="p">[]:</span>

        <span class="k">for</span> <span class="n">data_set</span> <span class="ow">in</span> <span class="n">data_sets_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data_set</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s">&#39;training&#39;</span><span class="p">:</span>
                <span class="n">data_set</span><span class="o">.</span><span class="n">select_features_ids</span><span class="p">(</span><span class="n">select_features_ids</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">skip_images_ids</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
         <span class="k">for</span> <span class="n">data_set</span> <span class="ow">in</span> <span class="n">data_sets_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data_set</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s">&#39;training&#39;</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s">&quot;training set images ids filtering&quot;</span>
                <span class="n">data_set</span><span class="o">.</span><span class="n">skip_images_id</span><span class="p">(</span><span class="n">skip_images_ids</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">data_set</span> <span class="ow">in</span> <span class="n">data_sets_list</span><span class="p">:</span>

        <span class="k">if</span> <span class="s">&#39;success&#39;</span> <span class="ow">in</span> <span class="n">data_set</span><span class="o">.</span><span class="n">features_names</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s">&quot;filtering success&quot;</span>
            <span class="n">msk_good</span><span class="o">=</span><span class="n">data_set</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;success&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span>
            <span class="n">data_set</span><span class="o">.</span><span class="n">select_features_ids</span><span class="p">(</span><span class="n">msk_good</span><span class="p">)</span>



    <span class="k">if</span>  <span class="n">feature_name</span> <span class="o">!=</span><span class="k">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">feature_min</span><span class="o">!=</span><span class="k">None</span> <span class="ow">or</span> <span class="n">feature_max</span><span class="o">!=</span><span class="k">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="n">data_set</span><span class="o">.</span><span class="n">features_names</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">data_set</span> <span class="ow">in</span> <span class="n">data_sets_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">feature_min</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
                    <span class="n">msk_good_1</span><span class="o">=</span><span class="n">data_set</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span><span class="o">&gt;</span><span class="n">feature_min</span>
                    <span class="n">data_set</span><span class="o">.</span><span class="n">select_features_ids</span><span class="p">(</span><span class="n">msk_good_1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">feature_max</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
                    <span class="n">msk_good_2</span><span class="o">=</span><span class="n">data_set</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span><span class="o">&lt;</span><span class="n">feature_max</span>
                    <span class="n">data_set</span><span class="o">.</span><span class="n">select_features_ids</span><span class="p">(</span><span class="n">msk_good_2</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">skip_class</span><span class="o">!=</span><span class="p">[]:</span>
        <span class="nb">print</span> <span class="s">&quot;filtering classes&quot;</span><span class="p">,</span><span class="n">skip_class</span>
        <span class="k">for</span> <span class="n">data_set</span> <span class="ow">in</span> <span class="n">data_sets_list</span><span class="p">:</span>
            <span class="n">data_set</span><span class="o">.</span><span class="n">skip_classes</span><span class="p">(</span><span class="n">skip_class</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">use_attr</span><span class="o">!=</span><span class="p">[]:</span>
        <span class="nb">print</span> <span class="s">&quot;filtering attr, use&quot;</span><span class="p">,</span><span class="n">use_attr</span>
        <span class="k">for</span> <span class="n">data_set</span> <span class="ow">in</span> <span class="n">data_sets_list</span><span class="p">:</span>
            <span class="n">data_set</span><span class="o">.</span><span class="n">use_features</span><span class="p">(</span><span class="n">use_attr</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">skip_attr</span><span class="o">!=</span><span class="p">[]:</span>
        <span class="nb">print</span> <span class="s">&quot;filtering attr, skip&quot;</span><span class="p">,</span><span class="n">skip_attr</span>
        <span class="k">for</span> <span class="n">data_set</span> <span class="ow">in</span> <span class="n">data_sets_list</span><span class="p">:</span>
            <span class="n">data_set</span><span class="o">.</span><span class="n">skip_features</span><span class="p">(</span><span class="n">skip_attr</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">skip_nan_entries</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">data_set</span> <span class="ow">in</span> <span class="n">data_sets_list</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s">&quot;filtering nan&quot;</span>
            <span class="n">data_set</span><span class="o">.</span><span class="n">filter_nan</span><span class="p">()</span>


    <span class="k">for</span> <span class="n">data_set</span> <span class="ow">in</span> <span class="n">data_sets_list</span><span class="p">:</span>
        <span class="n">data_set</span><span class="o">.</span><span class="n">filter_nan</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">test_th</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
        <span class="n">black_list</span><span class="o">=</span><span class="p">[]</span>
        <span class="kn">import</span> <span class="nn">itertools</span> <span class="k">as</span> <span class="nn">it</span>
        <span class="kn">from</span> <span class="nn">matplotlib.backends.backend_pdf</span> <span class="k">import</span> <span class="n">PdfPages</span>
        <span class="n">pdf_pages</span> <span class="o">=</span> <span class="n">PdfPages</span><span class="p">(</span><span class="s">&#39;multi.pdf&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">it</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">training_set</span><span class="o">.</span><span class="n">features_names</span><span class="p">)),</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">f_name_1</span><span class="p">,</span><span class="n">f_name_2</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span> <span class="n">training_set</span><span class="o">.</span><span class="n">plot_contour_scatter_plot</span><span class="p">(</span><span class="n">training_set</span><span class="o">.</span><span class="n">features_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">training_set</span><span class="o">.</span><span class="n">features_names</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="s">&#39;bwr&#39;</span><span class="p">,</span><span class="n">smoothing_scale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">n_levels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">&lt;</span> <span class="n">test_th</span><span class="p">:</span>
                <span class="n">black_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_name_1</span><span class="p">)</span>
                <span class="n">black_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_name_2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pdf_pages</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
        <span class="n">pdf_pages</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">training_set</span><span class="o">.</span><span class="n">skip_features</span><span class="p">(</span><span class="n">black_list</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">entropy_th</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
        <span class="n">training_set</span><span class="o">.</span><span class="n">entroy_pre_filter</span><span class="p">(</span><span class="n">th</span><span class="o">=</span><span class="n">entropy_th</span><span class="p">)</span>


    <span class="k">for</span> <span class="n">data_set</span> <span class="ow">in</span> <span class="n">data_sets_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">data_set</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s">&#39;training&#39;</span><span class="p">:</span>
            <span class="n">data_set</span><span class="o">.</span><span class="n">set_classifier</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">eval_feature_importance</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">training_set</span><span class="o">.</span><span class="n">eval_features_importance</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>

        <span class="n">training_set</span><span class="o">.</span><span class="n">recursive_features_elimination</span><span class="p">(</span><span class="n">percentile_th</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                       <span class="n">feat_n_min</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                       <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
                                       <span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span>
                                       <span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">data_set</span> <span class="ow">in</span> <span class="n">data_sets_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data_set</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s">&#39;training&#39;</span><span class="p">:</span>
                <span class="n">data_set</span><span class="o">.</span><span class="n">set_classifier</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">do_feat_std</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">training_set</span><span class="o">.</span><span class="n">do_feat_std</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">do_pca</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">training_set</span><span class="o">.</span><span class="n">do_pca</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">eval_feature_importance</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
            <span class="n">training_set</span><span class="o">.</span><span class="n">eval_features_importance</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">remove</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">file_name</span><span class="o">=</span><span class="s">&#39;feat_imp_pca&#39;</span><span class="p">)</span>





            <span class="k">for</span> <span class="n">data_set</span> <span class="ow">in</span> <span class="n">data_sets_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">data_set</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s">&#39;training&#39;</span><span class="p">:</span>
                        <span class="n">data_set</span><span class="o">.</span><span class="n">set_classifier</span><span class="p">()</span>


    <span class="k">if</span> <span class="n">eval_feature_importance_trend</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">training_set</span><span class="o">.</span><span class="n">do_features_importance_trend</span><span class="p">(</span><span class="n">n_estimators</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="n">training_set</span><span class="o">.</span><span class="n">do_features_importance_trend</span><span class="p">(</span><span class="n">n_estimators</span><span class="p">,</span><span class="n">order_increasing</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">feature_correlation_matrix</span><span class="o">!=</span><span class="k">False</span><span class="p">:</span>
        <span class="n">training_set</span><span class="o">.</span><span class="n">plot_feature_correlation_matrix</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">max_par_corr</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
        <span class="n">training_set</span><span class="o">.</span><span class="n">remove_correlated_features</span><span class="p">(</span><span class="n">n_estimators</span><span class="p">,</span><span class="n">max_par_corr</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">test_set</span><span class="o">!=</span><span class="k">None</span> <span class="p">:</span>
            <span class="n">test_set</span><span class="o">.</span><span class="n">use_features</span><span class="p">(</span><span class="n">training_set</span><span class="o">.</span><span class="n">features_names</span><span class="p">,</span><span class="n">whole_name</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">eval_best_tree_num</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">training_set</span><span class="o">.</span><span class="n">find_best_tree_num</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">MC_repl</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
        <span class="n">training_set</span><span class="o">.</span><span class="n">do_MC</span><span class="p">(</span><span class="n">MC_repl</span><span class="p">,</span><span class="n">n_estimators</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">cross_fold_N</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
        <span class="n">training_set</span><span class="o">.</span><span class="n">do_cross_fold_validation</span><span class="p">(</span><span class="n">n_folds</span><span class="o">=</span><span class="n">cross_fold_N</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cv_conf_matrix</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
        <span class="n">training_set</span><span class="o">.</span><span class="n">do_cv_confusion_matrix</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">roc_test_class</span><span class="o">!=</span><span class="k">None</span><span class="p">:</span>
        <span class="n">training_set</span><span class="o">.</span><span class="n">cv_roc_auc</span><span class="p">,</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span><span class="o">=</span><span class="n">do_roc_test</span><span class="p">(</span><span class="n">training_set</span><span class="o">.</span><span class="n">cv_predictions</span><span class="p">,</span><span class="n">training_set</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">classes_</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">roc_test_class</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span><span class="n">save_plot</span><span class="o">=</span><span class="n">save_plot</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">test_set</span><span class="o">!=</span><span class="k">None</span> <span class="p">:</span>
        <span class="k">if</span> <span class="n">feature_correlation_matrix</span><span class="o">!=</span><span class="k">False</span><span class="p">:</span>
            <span class="n">test_set</span><span class="o">=</span><span class="n">training_set</span><span class="o">.</span><span class="n">split_test_set</span><span class="p">(</span><span class="n">test_set_split_fraction</span><span class="p">)</span>
            <span class="n">test_set</span><span class="o">.</span><span class="n">plot_feature_correlation_matrix</span><span class="p">()</span>


        <span class="n">training_set</span><span class="o">.</span><span class="n">predict_test_set</span><span class="p">(</span><span class="n">test_set</span><span class="p">)</span>
        <span class="k">if</span> <span class="mi">1</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">pred_original</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">test_set</span><span class="o">.</span><span class="n">predictions</span><span class="p">)</span>




            <span class="n">training_set</span><span class="o">.</span><span class="n">set_classifier</span><span class="p">(</span><span class="s">&#39;RFC&#39;</span><span class="p">)</span>
            <span class="nb">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">training_set</span><span class="o">.</span><span class="n">class_labels</span><span class="p">),</span><span class="n">training_set</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">test_set</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">training_set</span><span class="o">.</span><span class="n">predict_test_set</span><span class="p">(</span><span class="n">test_set</span><span class="p">)</span>
            <span class="n">pred_2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">test_set</span><span class="o">.</span><span class="n">predictions</span><span class="p">)</span>
            <span class="n">pred_list</span><span class="o">=</span><span class="p">[</span><span class="n">pred_2</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">pred_list</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pred</span><span class="p">:</span>
                    <span class="n">ID</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">pred_original</span><span class="p">[</span><span class="s">&#39;image_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;image_id&#39;</span><span class="p">])</span>


                    <span class="n">proba_1</span><span class="o">=</span><span class="n">pred_original</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="s">&#39;proba&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                    <span class="n">proba_2</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;proba&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">proba_1</span><span class="o">&gt;=</span><span class="n">proba_2</span><span class="p">:</span>
                        <span class="n">pred_original</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="s">&#39;pred&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;pred&#39;</span><span class="p">]</span>


            <span class="n">eval_accuracy</span><span class="p">(</span><span class="n">pred_original</span><span class="p">[</span><span class="s">&#39;pred&#39;</span><span class="p">]</span>   <span class="p">,</span><span class="n">pred_original</span><span class="p">[</span><span class="s">&#39;actual&#39;</span><span class="p">],</span><span class="n">verbose</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>




    <span class="k">return</span> <span class="n">training_set</span><span class="p">,</span> <span class="n">test_set</span></div>




<div class="viewcode-block" id="load_data"><a class="viewcode-back" href="../../../../../api/asterism.core.machine_learning.old.classification.html#asterism.core.machine_learning.old.classification.load_data">[docs]</a><span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="n">files_list</span><span class="p">,</span><span class="n">label_file</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="n">label_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span><span class="n">label_col_name</span><span class="o">=</span><span class="s">&#39;class&#39;</span><span class="p">,</span><span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">skip_ids</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="n">max_id</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="n">msk</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">files_list</span><span class="p">)</span><span class="o">==</span><span class="p">():</span>
            <span class="n">files_list</span><span class="o">=</span><span class="p">[</span><span class="n">files_list</span><span class="p">]</span>

        <span class="n">data_sets_list</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files_list</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s">&quot;loading file&quot;</span><span class="p">,</span><span class="n">f</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">label_file</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
                    <span class="nb">print</span>  <span class="s">&quot;label col name&quot;</span><span class="p">,</span><span class="n">label_col_name</span>
                    <span class="n">data_class</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pf</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">ext</span><span class="o">=</span><span class="n">ext</span><span class="p">)[</span><span class="n">label_col_name</span><span class="p">])</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">chararray</span><span class="p">(</span><span class="n">data_class</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">label_size</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_class</span><span class="p">):</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="o">=</span><span class="n">c</span>

                    <span class="nb">print</span> <span class="n">data</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pf</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">ext</span><span class="o">=</span><span class="n">ext</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">label_file</span><span class="o">==</span><span class="k">True</span><span class="p">:</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s">&#39;image_id&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),(</span><span class="s">&#39;class&#39;</span><span class="p">,</span><span class="s">&#39;S%d&#39;</span><span class="o">%</span><span class="n">label_size</span><span class="p">)])[</span><span class="n">label_col_name</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;data  file %s, is neither txt nor fits, or the column %s is not present in &quot;</span><span class="o">%</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">label_col_name</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">skip_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span> <span class="ow">and</span> <span class="n">msk</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
                <span class="n">msk</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
                <span class="n">msk</span><span class="p">[</span><span class="n">skip_ids</span><span class="p">]</span><span class="o">=</span><span class="k">False</span>
                <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">skip_ids</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">and</span> <span class="n">msk</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
                <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>

            <span class="k">elif</span> <span class="n">max_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span> <span class="ow">and</span> <span class="n">skip_ids</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">and</span> <span class="n">msk</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
                <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">[:</span><span class="n">max_id</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">data_sets_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">data_sets_list</span></div>





<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>


</pre></div>

         </div>
       </div>


     </div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">asterism 1.0.a documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, andrea tramacere.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.8.
    </div>
  </body>
</html>